<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Статистический анализ временных рядов – ts-analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Поиск не дал результатов",
    "search-matching-documents-text": "Результаты поиска",
    "search-copy-link-title": "Скопировать ссылку",
    "search-hide-matches-text": "Скрыть дополнительные результаты",
    "search-more-match-text": "дополнительный результат в этом документе",
    "search-more-matches-text": "дополнительных результата(-ов) в этом документе",
    "search-clear-button-title": "Очистить",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Отменить",
    "search-submit-button-title": "Найти",
    "search-label": "Поиск"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="floating">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Содержание</h2>
   
  <ul class="collapse">
  <li><a href="#периодограмма-и-автокорреляционная-функция" id="toc-периодограмма-и-автокорреляционная-функция" class="nav-link active" data-scroll-target="#периодограмма-и-автокорреляционная-функция"><span class="header-section-number">1</span> Периодограмма и автокорреляционная функция</a>
  <ul class="collapse">
  <li><a href="#искусственные-данные" id="toc-искусственные-данные" class="nav-link" data-scroll-target="#искусственные-данные"><span class="header-section-number">1.1</span> Искусственные данные</a></li>
  <li><a href="#реальные-данные" id="toc-реальные-данные" class="nav-link" data-scroll-target="#реальные-данные"><span class="header-section-number">1.2</span> Реальные данные</a></li>
  </ul></li>
  <li><a href="#линейные-фильтры" id="toc-линейные-фильтры" class="nav-link" data-scroll-target="#линейные-фильтры"><span class="header-section-number">2</span> Линейные фильтры</a>
  <ul class="collapse">
  <li><a href="#ачх" id="toc-ачх" class="nav-link" data-scroll-target="#ачх"><span class="header-section-number">2.1</span> АЧХ</a></li>
  <li><a href="#искусственные-данные-1" id="toc-искусственные-данные-1" class="nav-link" data-scroll-target="#искусственные-данные-1"><span class="header-section-number">2.2</span> Искусственные данные</a></li>
  <li><a href="#реальные-данные-1" id="toc-реальные-данные-1" class="nav-link" data-scroll-target="#реальные-данные-1"><span class="header-section-number">2.3</span> Реальные данные</a></li>
  </ul></li>
  <li><a href="#ssa" id="toc-ssa" class="nav-link" data-scroll-target="#ssa"><span class="header-section-number">3</span> SSA</a>
  <ul class="collapse">
  <li><a href="#ранг" id="toc-ранг" class="nav-link" data-scroll-target="#ранг"><span class="header-section-number">3.1</span> Ранг</a></li>
  <li><a href="#разделимость" id="toc-разделимость" class="nav-link" data-scroll-target="#разделимость"><span class="header-section-number">3.2</span> Разделимость</a></li>
  <li><a href="#искусственные-данные-2" id="toc-искусственные-данные-2" class="nav-link" data-scroll-target="#искусственные-данные-2"><span class="header-section-number">3.3</span> Искусственные данные</a></li>
  <li><a href="#реальные-данные-2" id="toc-реальные-данные-2" class="nav-link" data-scroll-target="#реальные-данные-2"><span class="header-section-number">3.4</span> Реальные данные</a></li>
  </ul></li>
  <li><a href="#полиномиальная-регрессия" id="toc-полиномиальная-регрессия" class="nav-link" data-scroll-target="#полиномиальная-регрессия"><span class="header-section-number">4</span> Полиномиальная регрессия</a></li>
  <li><a href="#мультипликативная-модель" id="toc-мультипликативная-модель" class="nav-link" data-scroll-target="#мультипликативная-модель"><span class="header-section-number">5</span> Мультипликативная модель</a></li>
  <li><a href="#огибающая" id="toc-огибающая" class="nav-link" data-scroll-target="#огибающая"><span class="header-section-number">6</span> Огибающая</a></li>
  <li><a href="#гетероскедастичный-шум" id="toc-гетероскедастичный-шум" class="nav-link" data-scroll-target="#гетероскедастичный-шум"><span class="header-section-number">7</span> Гетероскедастичный шум</a></li>
  <li><a href="#loess-и-фильтр-hodrick-prescott" id="toc-loess-и-фильтр-hodrick-prescott" class="nav-link" data-scroll-target="#loess-и-фильтр-hodrick-prescott"><span class="header-section-number">8</span> LOESS и фильтр Hodrick-Prescott</a></li>
  <li><a href="#преобразование-бокса-кокса" id="toc-преобразование-бокса-кокса" class="nav-link" data-scroll-target="#преобразование-бокса-кокса"><span class="header-section-number">9</span> Преобразование Бокса-Кокса</a></li>
  <li><a href="#ssa-с-процекцией" id="toc-ssa-с-процекцией" class="nav-link" data-scroll-target="#ssa-с-процекцией"><span class="header-section-number">10</span> SSA с процекцией</a></li>
  <li><a href="#автоматическая-группировка-в-ssa" id="toc-автоматическая-группировка-в-ssa" class="nav-link" data-scroll-target="#автоматическая-группировка-в-ssa"><span class="header-section-number">11</span> Автоматическая группировка в SSA</a></li>
  <li><a href="#derivssa" id="toc-derivssa" class="nav-link" data-scroll-target="#derivssa"><span class="header-section-number">12</span> DerivSSA</a></li>
  <li><a href="#линейно-рекурентные-формулы" id="toc-линейно-рекурентные-формулы" class="nav-link" data-scroll-target="#линейно-рекурентные-формулы"><span class="header-section-number">13</span> Линейно-рекурентные формулы</a>
  <ul class="collapse">
  <li><a href="#ряды-без-шума" id="toc-ряды-без-шума" class="nav-link" data-scroll-target="#ряды-без-шума"><span class="header-section-number">13.1</span> Ряды без шума</a></li>
  <li><a href="#ряды-с-шумом" id="toc-ряды-с-шумом" class="nav-link" data-scroll-target="#ряды-с-шумом"><span class="header-section-number">13.2</span> Ряды с шумом</a></li>
  <li><a href="#итерации-cadzow" id="toc-итерации-cadzow" class="nav-link" data-scroll-target="#итерации-cadzow"><span class="header-section-number">13.3</span> Итерации Cadzow</a></li>
  <li><a href="#реальные-данные-3" id="toc-реальные-данные-3" class="nav-link" data-scroll-target="#реальные-данные-3"><span class="header-section-number">13.4</span> Реальные данные</a></li>
  </ul></li>
  <li><a href="#iterative-o-ssa" id="toc-iterative-o-ssa" class="nav-link" data-scroll-target="#iterative-o-ssa"><span class="header-section-number">14</span> Iterative O-SSA</a></li>
  <li><a href="#esprit-motivated-o-ssa" id="toc-esprit-motivated-o-ssa" class="nav-link" data-scroll-target="#esprit-motivated-o-ssa"><span class="header-section-number">15</span> Esprit-motivated O-SSA</a>
  <ul class="collapse">
  <li><a href="#модельные-ряды" id="toc-модельные-ряды" class="nav-link" data-scroll-target="#модельные-ряды"><span class="header-section-number">15.1</span> Модельные ряды</a></li>
  <li><a href="#реальные-данные-4" id="toc-реальные-данные-4" class="nav-link" data-scroll-target="#реальные-данные-4"><span class="header-section-number">15.2</span> Реальные данные</a></li>
  </ul></li>
  <li><a href="#classical-seasonal-decomposition-и-stl" id="toc-classical-seasonal-decomposition-и-stl" class="nav-link" data-scroll-target="#classical-seasonal-decomposition-и-stl"><span class="header-section-number">16</span> Classical seasonal decomposition и STL</a></li>
  <li><a href="#ssa-прогнозирование" id="toc-ssa-прогнозирование" class="nav-link" data-scroll-target="#ssa-прогнозирование"><span class="header-section-number">17</span> SSA прогнозирование</a>
  <ul class="collapse">
  <li><a href="#бутстреп-доверительныепредсказательные-интервалы" id="toc-бутстреп-доверительныепредсказательные-интервалы" class="nav-link" data-scroll-target="#бутстреп-доверительныепредсказательные-интервалы"><span class="header-section-number">17.1</span> Бутстреп-доверительные/предсказательные интервалы</a></li>
  </ul></li>
  <li><a href="#работа-с-пропусками" id="toc-работа-с-пропусками" class="nav-link" data-scroll-target="#работа-с-пропусками"><span class="header-section-number">18</span> Работа с пропусками</a>
  <ul class="collapse">
  <li><a href="#sequential" id="toc-sequential" class="nav-link" data-scroll-target="#sequential"><span class="header-section-number">18.1</span> Sequential</a></li>
  <li><a href="#simultaneous" id="toc-simultaneous" class="nav-link" data-scroll-target="#simultaneous"><span class="header-section-number">18.2</span> Simultaneous</a></li>
  <li><a href="#iterative" id="toc-iterative" class="nav-link" data-scroll-target="#iterative"><span class="header-section-number">18.3</span> Iterative</a></li>
  <li><a href="#сравнение-gapfill-и-igapfill" id="toc-сравнение-gapfill-и-igapfill" class="nav-link" data-scroll-target="#сравнение-gapfill-и-igapfill"><span class="header-section-number">18.4</span> Сравнение gapfill и igapfill</a></li>
  </ul></li>
  <li><a href="#процессы-arima" id="toc-процессы-arima" class="nav-link" data-scroll-target="#процессы-arima"><span class="header-section-number">19</span> Процессы ARIMA</a>
  <ul class="collapse">
  <li><a href="#модельные-ряды-1" id="toc-модельные-ряды-1" class="nav-link" data-scroll-target="#модельные-ряды-1"><span class="header-section-number">19.1</span> Модельные ряды</a></li>
  <li><a href="#реальные-данные-5" id="toc-реальные-данные-5" class="nav-link" data-scroll-target="#реальные-данные-5"><span class="header-section-number">19.2</span> Реальные данные</a></li>
  </ul></li>
  <li><a href="#seasonal-arima" id="toc-seasonal-arima" class="nav-link" data-scroll-target="#seasonal-arima"><span class="header-section-number">20</span> Seasonal ARIMA</a></li>
  <li><a href="#обнаружение-разладки" id="toc-обнаружение-разладки" class="nav-link" data-scroll-target="#обнаружение-разладки"><span class="header-section-number">21</span> Обнаружение разладки</a>
  <ul class="collapse">
  <li><a href="#модельные-ряды-2" id="toc-модельные-ряды-2" class="nav-link" data-scroll-target="#модельные-ряды-2"><span class="header-section-number">21.1</span> Модельные ряды</a></li>
  <li><a href="#реальные-ряды" id="toc-реальные-ряды" class="nav-link" data-scroll-target="#реальные-ряды"><span class="header-section-number">21.2</span> Реальные ряды</a></li>
  </ul></li>
  <li><a href="#экспоненциальное-сглаживание" id="toc-экспоненциальное-сглаживание" class="nav-link" data-scroll-target="#экспоненциальное-сглаживание"><span class="header-section-number">22</span> Экспоненциальное сглаживание</a>
  <ul class="collapse">
  <li><a href="#simple-exponential-smoothing" id="toc-simple-exponential-smoothing" class="nav-link" data-scroll-target="#simple-exponential-smoothing"><span class="header-section-number">22.1</span> Simple exponential smoothing</a></li>
  <li><a href="#holts-method" id="toc-holts-method" class="nav-link" data-scroll-target="#holts-method"><span class="header-section-number">22.2</span> Holt’s method</a></li>
  <li><a href="#holt-winters-method" id="toc-holt-winters-method" class="nav-link" data-scroll-target="#holt-winters-method"><span class="header-section-number">22.3</span> Holt-Winters’ method</a></li>
  <li><a href="#выбор-модели" id="toc-выбор-модели" class="nav-link" data-scroll-target="#выбор-модели"><span class="header-section-number">22.4</span> Выбор модели</a></li>
  </ul></li>
  <li><a href="#mssa" id="toc-mssa" class="nav-link" data-scroll-target="#mssa"><span class="header-section-number">23</span> MSSA</a>
  <ul class="collapse">
  <li><a href="#сравнение-с-ssa" id="toc-сравнение-с-ssa" class="nav-link" data-scroll-target="#сравнение-с-ssa"><span class="header-section-number">23.1</span> Сравнение с SSA</a></li>
  <li><a href="#одинаковая-структура" id="toc-одинаковая-структура" class="nav-link" data-scroll-target="#одинаковая-структура"><span class="header-section-number">23.2</span> Одинаковая структура</a></li>
  <li><a href="#разная-структура" id="toc-разная-структура" class="nav-link" data-scroll-target="#разная-структура"><span class="header-section-number">23.3</span> Разная структура</a></li>
  <li><a href="#поддерживающий-ряд" id="toc-поддерживающий-ряд" class="nav-link" data-scroll-target="#поддерживающий-ряд"><span class="header-section-number">23.4</span> Поддерживающий ряд</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Статистический анализ временных рядов</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Подключаем необходимые библиотеки:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mFilter)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doFuture)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doRNG)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tseries)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"./R/eossa_new.R"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="периодограмма-и-автокорреляционная-функция" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Периодограмма и автокорреляционная функция</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>periodogram <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spec.pgram</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">taper =</span> <span class="dv">0</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fast =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">detrend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.action =</span> na.contiguous</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>ggperiodogram <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">points =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  sp <span class="ot">&lt;-</span> <span class="fu">periodogram</span>(x)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  spData <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">frequency =</span> sp<span class="sc">$</span>freq, <span class="at">spectrum =</span> sp<span class="sc">$</span>spec)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(spData, <span class="fu">aes</span>(<span class="at">x =</span> frequency, <span class="at">y =</span> spectrum)) <span class="sc">+</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (points)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>) </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  p</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>em_harmonic <span class="ot">&lt;-</span> <span class="cf">function</span>(N, freq, <span class="at">A =</span> <span class="dv">1</span>, <span class="at">a =</span> <span class="dv">0</span>, <span class="at">phase =</span> <span class="dv">0</span>) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  A <span class="sc">*</span> <span class="fu">exp</span>(a <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span>N)) <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span>N) <span class="sc">*</span> freq <span class="sc">+</span> phase)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="искусственные-данные" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="искусственные-данные"><span class="header-section-number">1.1</span> Искусственные данные</h2>
<p>Случай, когда частота попадает в решетку периодограммы:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(<span class="fu">em_harmonic</span>(N, <span class="fl">0.25</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-5-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Когда частота не попадает, наблюдается эффект растекания частоты:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(<span class="fu">em_harmonic</span>(N, <span class="fl">0.255</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-6-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Белый шум:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rnorm</span>(N) <span class="sc">|&gt;</span> <span class="fu">ggtsdisplay</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-7-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Красный шум:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> <span class="fl">0.7</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>rn_start <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">sd =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> phi<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ar =</span> phi), N, <span class="at">n.start =</span> <span class="dv">1</span>, <span class="at">start.innov =</span> rn_start) <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtsdisplay</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-8-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>При увеличении длины ряда значение периодограммы в частоте, соответствующей гармонике, увеличивается, а в частотах, соответствующих шуму, остаются теми же.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>cos4 <span class="ot">&lt;-</span> <span class="fu">em_harmonic</span>(N, <span class="fl">0.25</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>wn <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>per1 <span class="ot">&lt;-</span> <span class="fu">ggperiodogram</span>(<span class="fu">head</span>(wn <span class="sc">+</span> cos4, <span class="dv">100</span>))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>per2 <span class="ot">&lt;-</span> <span class="fu">ggperiodogram</span>(wn <span class="sc">+</span> cos4)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(per1 <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="fu">max</span>(per2<span class="sc">$</span>data<span class="sc">$</span>spectrum)), per2, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-9-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>rn_start <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">sd =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> phi<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>rn <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ar =</span> phi), N, <span class="at">n.start =</span> <span class="dv">1</span>, <span class="at">start.innov =</span> rn_start)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>per1 <span class="ot">&lt;-</span> <span class="fu">ggperiodogram</span>(<span class="fu">head</span>(rn <span class="sc">+</span> cos4, <span class="dv">100</span>))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>per2 <span class="ot">&lt;-</span> <span class="fu">ggperiodogram</span>(rn <span class="sc">+</span> cos4)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(per1 <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="fu">max</span>(per2<span class="sc">$</span>data<span class="sc">$</span>spectrum)), per2, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-10-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="реальные-данные" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="реальные-данные"><span class="header-section-number">1.2</span> Реальные данные</h2>
<section id="яркость-определенной-звезды-в-полночь" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="яркость-определенной-звезды-в-полночь"><span class="header-section-number">1.2.1</span> Яркость определенной звезды в полночь</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"star"</span>, <span class="at">package =</span> <span class="st">"astsa"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(star)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-11-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>per <span class="ot">&lt;-</span> <span class="fu">ggperiodogram</span>(star)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>per<span class="sc">$</span>data<span class="sc">$</span>frequency[<span class="fu">order</span>(per<span class="sc">$</span>data<span class="sc">$</span>spectrum, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]]</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0.03500000 0.04166667</code></pre>
</div>
</div>
<p>На периодограмме есть два заметных пика. Эти пики приходятся на частоты <span class="math inline">\(\omega_1=21/600 = 0.035\)</span> и <span class="math inline">\(\omega_2=25/600\approx0.04167\)</span>. Эти частоты соответствуют периодам <span class="math inline">\(600/21\approx28.57\)</span> и <span class="math inline">\(24\)</span> дня соответственно.</p>
</section>
<section id="использование-розничных-дебетовых-карт-в-исландии" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="использование-розничных-дебетовых-карт-в-исландии"><span class="header-section-number">1.2.2</span> Использование розничных дебетовых карт в Исландии</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"debitcards"</span>, <span class="at">package =</span> <span class="st">"fpp"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(debitcards)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-13-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Похоже, что модель не аддитивная, прологарифмируем ее:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>debit_log <span class="ot">&lt;-</span> <span class="fu">log</span>(debitcards)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(debit_log)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-14-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Стало лучше. В ряде, очевидно, присутствует тренд. Удалим линейный тренд и построим периодограмму заного.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>debit_detrended <span class="ot">&lt;-</span> <span class="fu">tslm</span>(debit_log <span class="sc">~</span> trend)<span class="sc">$</span>resid</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(debit_detrended)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-15-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>По виду остатков видно, что у ряда нелинейный тренд.</p>
</section>
<section id="ежегодный-минимальный-уровень-воды-реки-нил" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="ежегодный-минимальный-уровень-воды-реки-нил"><span class="header-section-number">1.2.3</span> Ежегодный минимальный уровень воды реки Нил</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"NileMin"</span>, <span class="at">package =</span> <span class="st">"longmemo"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(NileMin)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-16-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="линейные-фильтры" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Линейные фильтры</h1>
<section id="ачх" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="ачх"><span class="header-section-number">2.1</span> АЧХ</h2>
<p>Построим амплитудно-частотную характеристику (АЧХ) для некотопых фильтров.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>afc <span class="ot">&lt;-</span> <span class="cf">function</span>(filter, freq, <span class="at">plot =</span> <span class="cn">TRUE</span>, ...) {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">seq_along</span>(filter) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> <span class="cf">function</span>(o) <span class="fu">sum</span>(<span class="fu">rev</span>(filter) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">2</span>i <span class="sc">*</span> pi <span class="sc">*</span> k <span class="sc">*</span> o))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">freq =</span> freq, <span class="at">afc =</span> <span class="fu">abs</span>(<span class="fu">sapply</span>(freq, h)))</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (plot) {</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(res<span class="sc">$</span>afc <span class="sc">~</span> res<span class="sc">$</span>freq, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">xlab =</span> <span class="st">"frequency"</span>, <span class="at">ylab =</span> <span class="st">"AFC"</span>, ...)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invisible</span>(res)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> res</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Скользащее среднее:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>filt_ma <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">12</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>freq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">0.001</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">afc</span>(filt_ma, freq)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-18-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Последовательная разность:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>filt_diff <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">afc</span>(filt_diff, freq)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-19-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Сезонная разность:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>filt_diff12 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">11</span>), <span class="sc">-</span><span class="dv">1</span>) </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">afc</span>(filt_diff12, freq)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-20-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="искусственные-данные-1" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="искусственные-данные-1"><span class="header-section-number">2.2</span> Искусственные данные</h2>
<p>Применим сезонную разность. Периодограмма до применения фильтра:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>seasonality <span class="ot">&lt;-</span> <span class="fu">mapply</span>(em_harmonic, N, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">/</span> <span class="dv">12</span>, <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="dv">1</span>)) <span class="sc">|&gt;</span> <span class="fu">rowSums</span>()</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">ts</span>(seasonality <span class="sc">+</span> wn, <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggperiodogram</span>(x1)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-21-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>После применения фильтра видно, что значение периодограммы в точках, соответствующих периодам 12, 6, 4, 3, 2.4, 2 примерно нулевое.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>x1_deseason <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">filter</span>(x1, filt_diff12)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggperiodogram</span>(x1_deseason)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-22-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Теперь рассмотрим ряд с экспоненциальным трендом и выделим его с помощью скользящего среднего:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>trend <span class="ot">&lt;-</span> <span class="fu">em_harmonic</span>(N, <span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">1</span> <span class="sc">/</span> N)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">ts</span>(trend <span class="sc">+</span> wn)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(x2, trend),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"Trend"</span>), <span class="at">space =</span> <span class="st">"top"</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-23-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>x2_ma <span class="ot">&lt;-</span> <span class="fu">ts_filter</span>(x2, <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">19</span>), <span class="fl">0.5</span>) <span class="sc">/</span> <span class="dv">20</span>, <span class="dv">2</span>, <span class="st">"renormalize"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>x2_resid <span class="ot">&lt;-</span> x2 <span class="sc">-</span> x2_ma</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(x2, trend, x2_ma),</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"grey"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>),</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"Trend"</span>, <span class="st">"Moving average"</span>), <span class="at">space =</span> <span class="st">"top"</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-25-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Периодограмма остатков:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggperiodogram</span>(x2_resid)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-26-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Оценим спектральную плотность с помощью скользащего среднего. Белый шум:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>spec_wn <span class="ot">&lt;-</span> <span class="fu">ggperiodogram</span>(wn)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>spec_wn_ma <span class="ot">&lt;-</span> <span class="fu">ts_filter</span>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  spec_wn<span class="sc">$</span>data<span class="sc">$</span>spectrum,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">99</span>), <span class="fl">0.5</span>) <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sides =</span> <span class="dv">2</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">boundary =</span> <span class="st">"renormalize"</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>spec_wn <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> frequency, <span class="at">y =</span> spec_wn_ma), <span class="at">colour =</span> <span class="st">"blue"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-27-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Красный шум:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>spec_rn <span class="ot">&lt;-</span> <span class="fu">ggperiodogram</span>(rn)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>spec_rn_ma <span class="ot">&lt;-</span> <span class="fu">ts_filter</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  spec_rn<span class="sc">$</span>data<span class="sc">$</span>spec,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">49</span>), <span class="fl">0.5</span>) <span class="sc">/</span> <span class="dv">50</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sides =</span> <span class="dv">2</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">boundary =</span> <span class="st">"renormalize"</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>spec_rn <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> frequency, <span class="at">y =</span> spec_rn_ma), <span class="at">colour =</span> <span class="st">"blue"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-28-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="реальные-данные-1" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="реальные-данные-1"><span class="header-section-number">2.3</span> Реальные данные</h2>
<section id="звездная-величина" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="звездная-величина"><span class="header-section-number">2.3.1</span> Звездная величина</h3>
<p>С помощью сезонной разности выделим гармоники с периодами 29 и 24.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>star24 <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">filter</span>(star, <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">28</span>), <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>star29 <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">filter</span>(star, <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">23</span>), <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="fu">autoplot</span>(star24), <span class="fu">autoplot</span>(star29), <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-29-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Периодограммы остатков.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>per1 <span class="ot">&lt;-</span> <span class="fu">ggperiodogram</span>(star24) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="fl">0.02</span>, <span class="fl">0.06</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>per2 <span class="ot">&lt;-</span> <span class="fu">ggperiodogram</span>(star29) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="fl">0.02</span>, <span class="fl">0.06</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(per1, per2, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-30-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="дебетовые-карты" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="дебетовые-карты"><span class="header-section-number">2.3.2</span> Дебетовые карты</h3>
<p>Выделим тренд с помощью скользащего среднего.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>debit_ma <span class="ot">&lt;-</span> <span class="fu">ts_filter</span>(debit_log, <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">23</span>), <span class="fl">0.5</span>) <span class="sc">/</span> <span class="dv">24</span>, <span class="dv">2</span>, <span class="st">"renormalize"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(debit_log, debit_ma),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"Moving average"</span>), <span class="at">space =</span> <span class="st">"top"</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-31-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Остатки:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>debit_detrend <span class="ot">&lt;-</span> debit_log <span class="sc">-</span> debit_ma</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(debit_detrend)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-32-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>В целом, тренд выделился хорошо. Теперь удалим сезонность и посмотрим на остатки:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>debit_resid <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">filter</span>(debit_detrend, <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">11</span>), <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(debit_resid)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: Removed 12 rows containing missing values or values outside the scale range
## (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-33-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="уровень-воды-реки-нил" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="уровень-воды-реки-нил"><span class="header-section-number">2.3.3</span> Уровень воды реки Нил</h3>
<p>Оценим тренд скользащим средним.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"NileMin"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning in data("NileMin"): данные 'NileMin' не найдены</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>NileMin_ma <span class="ot">&lt;-</span> <span class="fu">ts_filter</span>(NileMin, <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">99</span>), <span class="fl">0.5</span>) <span class="sc">/</span> <span class="dv">100</span>, <span class="dv">2</span>, <span class="st">"renormalize"</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(NileMin, NileMin_ma),</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"Moving average"</span>), <span class="at">space =</span> <span class="st">"top"</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-34-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Получился довольно неровный тренд.</p>
</section>
</section>
</section>
<section id="ssa" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> SSA</h1>
<section id="ранг" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="ранг"><span class="header-section-number">3.1</span> Ранг</h2>
<p>Ранг гармоники с частотой <span class="math inline">\(\omega\ne0.5\)</span> равен <span class="math inline">\(2\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">71</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="dv">24</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">em_harmonic</span>(N, <span class="dv">1</span> <span class="sc">/</span> <span class="dv">12</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">ssa</span>(x, L)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-35-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="st">"vectors"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-35-2.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Ранг гармоники с частотой <span class="math inline">\(0.5\)</span> равен <span class="math inline">\(1\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">em_harmonic</span>(N, <span class="fl">0.5</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">ssa</span>(x, L)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-36-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="st">"vectors"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-36-2.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Ранг полинома степени <span class="math inline">\(p\)</span> равен <span class="math inline">\(p+1\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>N) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">:</span>N)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">ssa</span>(x, L)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-37-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="st">"vectors"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-37-2.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="разделимость" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="разделимость"><span class="header-section-number">3.2</span> Разделимость</h2>
<p>Сумма гармоник с разными амплитудами и частотами сильно разделима.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.2</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>freq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>) <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">mapply</span>(em_harmonic, N, freq, A) <span class="sc">|&gt;</span> <span class="fu">rowSums</span>()</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">ssa</span>(x, L)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="st">"vectors"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-39-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>По двумерному графику левых сингулярных векторов можно заметить, что соответствующие целому периоду <span class="math inline">\(T\)</span> компоненты образовывают вершины правильного <span class="math inline">\(T\)</span>-угольника (периоды <span class="math inline">\(12\)</span>, <span class="math inline">\(6\)</span> и <span class="math inline">\(4\)</span>), а компоненты, соответствующие периоду вида <span class="math inline">\(p/q\)</span> с взаимно простыми целыми <span class="math inline">\(p\)</span> и <span class="math inline">\(q\)</span>, образуют вершины правильного <span class="math inline">\(p\)</span>-угольника (период <span class="math inline">\(12/5=2.4\)</span>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="st">"paired"</span>, <span class="at">idx =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-40-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reconstruct</span>(s, <span class="fu">list</span>(<span class="at">S12 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">S6 =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">S4 =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">S2.4 =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>)),</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.method =</span> <span class="st">"xyplot"</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-41-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Сумма гармоник с разными частотами, но одинаковыми амплитудами слабо разделима, но не разделима по вкладам.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">mapply</span>(em_harmonic, N, freq[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]) <span class="sc">|&gt;</span> <span class="fu">rowSums</span>()</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">ssa</span>(x, L)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="st">"vectors"</span>, <span class="at">idx =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-42-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Левые сингулярные векторы смешались друг с другом. Это также видно по матрице <span class="math inline">\(W\)</span>-корреляций:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">wcor</span>(s, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-43-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Разделимости нет в случае суммы константы и экспоненты:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">em_harmonic</span>(N, <span class="dv">0</span>, <span class="at">a =</span> <span class="fl">0.02</span>) <span class="sc">+</span> <span class="dv">10</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">ssa</span>(x, L)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-44-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Видно, что разделимость по вкладу есть. Посмотрим на восстановленные компоненты:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reconstruct</span>(s, <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>)),</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.method =</span> <span class="st">"xyplot"</span>,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">add.residuals =</span> <span class="cn">FALSE</span>,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">space =</span> <span class="st">"top"</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-45-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Константа явно не отделилась от экспоненты.</p>
</section>
<section id="искусственные-данные-2" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="искусственные-данные-2"><span class="header-section-number">3.3</span> Искусственные данные</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>s_x1 <span class="ot">&lt;-</span> <span class="fu">ssa</span>(x1)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_x1, <span class="st">"paired"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-46-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Выбираем первые <span class="math inline">\(4\)</span> компоненты.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>r_s1 <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(s_x1, <span class="fu">list</span>(<span class="at">S12 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">S6 =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>))</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(r_s1, <span class="at">plot.method =</span> <span class="st">"xyplot"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-47-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>s_x2 <span class="ot">&lt;-</span> <span class="fu">ssa</span>(x2)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_x2, <span class="st">"vectors"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-48-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Убеждаемся, что ранг экспоненциального тренда равен <span class="math inline">\(1\)</span>, выделим первую компоненту.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>r_x2 <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(s_x2, <span class="fu">list</span>(<span class="at">Trend =</span> <span class="dv">1</span>))</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  r_x2,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.method =</span> <span class="st">"xyplot"</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">space =</span> <span class="st">"top"</span>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-49-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="реальные-данные-2" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="реальные-данные-2"><span class="header-section-number">3.4</span> Реальные данные</h2>
<section id="звездная-величина-1" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="звездная-величина-1"><span class="header-section-number">3.4.1</span> Звездная величина</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>s_star <span class="ot">&lt;-</span> <span class="fu">ssa</span>(star)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_star, <span class="st">"vectors"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-50-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_star, <span class="st">"paired"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-50-2.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Судя по двумерным графикам, компоненты <span class="math inline">\(2\)</span> и <span class="math inline">\(3\)</span>, <span class="math inline">\(4\)</span> и <span class="math inline">\(5\)</span>, <span class="math inline">\(7\)</span> и <span class="math inline">\(8\)</span> соответствуют гармоникам. Компоненты <span class="math inline">\(7\)</span> и <span class="math inline">\(8\)</span> соответствуют периоду <span class="math inline">\(4\)</span>, а период остальных гармоник оценить визуально затруднительно, поэтому воспользуемся <code>parestimate</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parestimate</span>(s_star, <span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## $F1
##    period     rate   |    Mod     Arg  |     Re        Im
##    28.800  -0.000016 |  0.99998   0.22 |  0.97628   0.21644
##   -28.800  -0.000016 |  0.99998  -0.22 |  0.97628  -0.21644
## 
## $F2
##    period     rate   |    Mod     Arg  |     Re        Im
##    24.152  -0.000027 |  0.99997   0.26 |  0.96632   0.25722
##   -24.152  -0.000027 |  0.99997  -0.26 |  0.96632  -0.25722
## 
## $F3
##    period     rate   |    Mod     Arg  |     Re        Im
##     4.005  -0.001537 |  0.99846   1.57 |  0.00186   0.99846
##    -4.005  -0.001537 |  0.99846  -1.57 |  0.00186  -0.99846</code></pre>
</div>
</div>
<p>Получили, что компоненты <span class="math inline">\(2\)</span> и <span class="math inline">\(3\)</span> соответствуют периоду <span class="math inline">\(29\)</span>, а <span class="math inline">\(4\)</span> и <span class="math inline">\(5\)</span> — периоду <span class="math inline">\(24\)</span>. Также убедились, что период компонент <span class="math inline">\(7\)</span> и <span class="math inline">\(8\)</span>, действительно, равен <span class="math inline">\(4\)</span>. Также интересен период шестой компоненты, построим ее периодограмму:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggperiodogram</span>(s_star<span class="sc">$</span>U[, <span class="dv">6</span>])</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-52-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Периодограмма имеет единственный пик в <span class="math inline">\(\omega=0.5\)</span>, значит <span class="math inline">\(6\)</span>-я компонента соответствует гармонике с периодом <span class="math inline">\(2\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>r_star <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(s_star, <span class="at">groups =</span> <span class="fu">list</span>(<span class="at">S29 =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">S24 =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">S2 =</span> <span class="dv">6</span>, <span class="at">S4 =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>))</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(r_star, <span class="at">plot.method =</span> <span class="st">"xyplot"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-53-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="дебетовые-карты-1" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="дебетовые-карты-1"><span class="header-section-number">3.4.2</span> Дебетовые карты</h3>
<p>Возьмем длину окна, кратной всем периодам сезонности (т.е. <span class="math inline">\(12\)</span>, <span class="math inline">\(6\)</span>, <span class="math inline">\(4\)</span>, <span class="math inline">\(3\)</span>, <span class="math inline">\(2.4\)</span> и <span class="math inline">\(2\)</span>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>s_debit <span class="ot">&lt;-</span> <span class="fu">ssa</span>(debit_log, <span class="dv">72</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_debit, <span class="st">"vectors"</span>, <span class="at">idx =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-54-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Похоже, тренду соответствуют компоненты <span class="math inline">\(1\)</span>, <span class="math inline">\(2\)</span> и <span class="math inline">\(5\)</span>. Но видно, что <span class="math inline">\(5\)</span>-я компонента смешалась с гармоникой. Посмотрим на матрицу <span class="math inline">\(W-корреляций\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">wcor</span>(s_debit, <span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-55-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Действительно, компоненты с <span class="math inline">\(6\)</span> по <span class="math inline">\(11\)</span> смешались друг с другом, <span class="math inline">\(5\)</span>-я компонента смешалась вместе с ними. Также заметим, что <span class="math inline">\(5\)</span>-я компонента коррелирует с компонентами <span class="math inline">\(2\)</span> и <span class="math inline">\(17\)</span>, поэтому будем считать, что компоненты <span class="math inline">\(1\)</span>, <span class="math inline">\(2\)</span> <span class="math inline">\(5\)</span> и <span class="math inline">\(17\)</span> соответствуют тренду.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parestimate</span>(s_debit, <span class="fu">list</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">10</span><span class="sc">:</span><span class="dv">11</span>, <span class="dv">12</span><span class="sc">:</span><span class="dv">13</span>, <span class="dv">14</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## $F1
##    period     rate   |    Mod     Arg  |     Re        Im
##     6.055  -0.021244 |  0.97898   1.04 |  0.49755   0.84312
##    -6.055  -0.021244 |  0.97898  -1.04 |  0.49755  -0.84312
## 
## $F2
##    period     rate   |    Mod     Arg  |     Re        Im
##     4.037  -0.114560 |  0.89176   1.56 |  0.01297   0.89166
##    -4.037  -0.114560 |  0.89176  -1.56 |  0.01297  -0.89166
## 
## $F3
##    period     rate   |    Mod     Arg  |     Re        Im
##     2.994  -0.012886 |  0.98720   2.10 | -0.49747   0.85269
##    -2.994  -0.012886 |  0.98720  -2.10 | -0.49747  -0.85269
## 
## $F4
##    period     rate   |    Mod     Arg  |     Re        Im
##     2.000  -0.013771 |  0.98632   3.14 | -0.98632   0.00000</code></pre>
</div>
</div>
<p>Комопоненты <span class="math inline">\(3\)</span> и <span class="math inline">\(4\)</span>, <span class="math inline">\(10\)</span> и <span class="math inline">\(11\)</span>, <span class="math inline">\(12\)</span> и <span class="math inline">\(13\)</span>, и <span class="math inline">\(14\)</span> соответствуют гармоникам с периодами <span class="math inline">\(6\)</span>, <span class="math inline">\(4\)</span>, <span class="math inline">\(3\)</span> и <span class="math inline">\(2\)</span> соответственно. Поскольку комопонент сезонности всего <span class="math inline">\(2 \cdot 5 + 1=11\)</span>, возьмем компоненты <span class="math inline">\(3\)</span>, <span class="math inline">\(4\)</span> и с <span class="math inline">\(6\)</span> по <span class="math inline">\(14\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>r_debit <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(s_debit, <span class="fu">list</span>(<span class="at">Trend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">17</span>), <span class="at">Seasonality =</span> <span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">6</span><span class="sc">:</span><span class="dv">14</span>)))</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(r_debit, <span class="at">plot.method =</span> <span class="st">"xyplot"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-57-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Взглянем на периодограмму остатков:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggperiodogram</span>(<span class="fu">resid</span>(r_debit))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-58-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Как видим, сезонность успешно удалена.</p>
<p>Сравним полученный с помощью SSA тренд с трендом, полученным с помощью скользащего среднего ранее.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(debit_log, r_debit<span class="sc">$</span>Trend, debit_ma),</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"grey"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>),</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"SSA"</span>, <span class="st">"Moving average"</span>), <span class="at">space =</span> <span class="st">"top"</span>)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-59-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Получили примерно тоже самое, но у SSA получился более точный тренд на концах.</p>
</section>
<section id="уровень-реки-нил" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="уровень-реки-нил"><span class="header-section-number">3.4.3</span> Уровень реки Нил</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>s_NileMin <span class="ot">&lt;-</span> <span class="fu">ssa</span>(NileMin)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_NileMin, <span class="st">"vectors"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-60-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Компоненты <span class="math inline">\(2\)</span> и <span class="math inline">\(3\)</span> соответствуют гармонике с некоторым периодом. Оценим его:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parestimate</span>(s_NileMin, <span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##    period     rate   |    Mod     Arg  |     Re        Im
##   237.862   0.000346 |  1.00035   0.03 |  1.00000   0.02642
##  -237.862   0.000346 |  1.00035  -0.03 |  1.00000  -0.02642</code></pre>
</div>
</div>
<p>Период гармоники составлят примерно <span class="math inline">\(238\)</span> лет. Это достаточно большой период, поэтому включим компоненты <span class="math inline">\(2\)</span> и <span class="math inline">\(3\)</span> в тренд вместе с компонентой <span class="math inline">\(1\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>r_NileMin <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(s_NileMin, <span class="fu">list</span>(<span class="at">Trend =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>))</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  r_NileMin,</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.method =</span> <span class="st">"xyplot"</span>,</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">space =</span> <span class="st">"top"</span>)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-62-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Стравним полученный тренд со скользащим средним.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(NileMin, r_NileMin<span class="sc">$</span>Trend, NileMin_ma),</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"grey"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>),</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"SSA"</span>, <span class="st">"Moving average"</span>), <span class="at">space =</span> <span class="st">"top"</span>)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-63-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>У SSA получился более плавный тренд.</p>
</section>
</section>
</section>
<section id="полиномиальная-регрессия" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Полиномиальная регрессия</h1>
<p>Оценим тренд реальных данных с помощью полиномиальной регрессии.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">length</span>(debit_log)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>debit_poly1 <span class="ot">&lt;-</span> <span class="fu">tslm</span>(debit_log <span class="sc">~</span> <span class="fu">poly</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="dv">1</span>))</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>debit_poly2 <span class="ot">&lt;-</span> <span class="fu">tslm</span>(debit_log <span class="sc">~</span> <span class="fu">poly</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="dv">2</span>))</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>debit_poly3 <span class="ot">&lt;-</span> <span class="fu">tslm</span>(debit_log <span class="sc">~</span> <span class="fu">poly</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="dv">5</span>))</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(debit_log, <span class="fu">fitted</span>(debit_poly1), <span class="fu">fitted</span>(debit_poly2), <span class="fu">fitted</span>(debit_poly3)),</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"grey"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"orange"</span>),</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"lm"</span>, <span class="st">"poly(degree = 2)"</span>, <span class="st">"poly(degree = 3)"</span>),</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">space =</span> <span class="st">"top"</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-64-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Полином степени <span class="math inline">\(3\)</span> уже хорошо аппроксимирует данные.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">length</span>(NileMin)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>NileMin_poly5 <span class="ot">&lt;-</span> <span class="fu">tslm</span>(NileMin <span class="sc">~</span> <span class="fu">poly</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="dv">5</span>))</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>NileMin_poly10 <span class="ot">&lt;-</span> <span class="fu">tslm</span>(NileMin <span class="sc">~</span> <span class="fu">poly</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="dv">10</span>))</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>NileMin_poly15 <span class="ot">&lt;-</span> <span class="fu">tslm</span>(NileMin <span class="sc">~</span> <span class="fu">poly</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="dv">15</span>))</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(NileMin, <span class="fu">fitted</span>(NileMin_poly5), <span class="fu">fitted</span>(NileMin_poly10), <span class="fu">fitted</span>(NileMin_poly15)),</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"grey"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"orange"</span>),</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"poly(degree = 5)"</span>, <span class="st">"poly(degree = 10)"</span>, <span class="st">"poly(degree = 15)"</span>),</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">space =</span> <span class="st">"top"</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-65-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Тут, похоже, подходит <span class="math inline">\(10\)</span> степень полинома.</p>
</section>
<section id="мультипликативная-модель" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Мультипликативная модель</h1>
<p>Сгенерируем ряд, удовлетворяющий мультипликативной модели: <span class="math display">\[
\mathsf{X}=\mathsf{T}(1 + \mathsf{S})(1 + \mathsf{N}).
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>trend_mult <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>N)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span>N) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>x_mult <span class="ot">&lt;-</span> <span class="fu">ts</span>(trend_mult <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> seasonality) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.25</span> <span class="sc">*</span> wn))</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(x_mult, <span class="at">main =</span> <span class="st">"Multiplicative model"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-66-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Оценим тренд полиномиальной регрессией.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>lm_mult <span class="ot">&lt;-</span> <span class="fu">tslm</span>(x_mult <span class="sc">~</span> <span class="fu">poly</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="dv">2</span>))</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>ci_mult <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_mult, <span class="fu">data.frame</span>(<span class="dv">1</span><span class="sc">:</span>N), <span class="at">interval =</span> <span class="st">"confidence"</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(x_mult, ci_mult),</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"gray"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"blue"</span>),</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"Regression line"</span>, <span class="st">"95% confidence interval"</span>),</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">space =</span> <span class="st">"top"</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-67-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Теперь прологарифмируем ряд и оценим тренд.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>lm_add <span class="ot">&lt;-</span> <span class="fu">tslm</span>(<span class="fu">log</span>(x_mult) <span class="sc">~</span> <span class="fu">poly</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="dv">5</span>))</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>ci_add <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_add, <span class="fu">data.frame</span>(<span class="dv">1</span><span class="sc">:</span>N), <span class="at">interval =</span> <span class="st">"confidence"</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="fu">log</span>(x_mult), ci_add),</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"gray"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"blue"</span>),</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">c</span>(<span class="st">"ln(Original)"</span>, <span class="st">"Regression line"</span>, <span class="st">"95% confidence interval"</span>),</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">space =</span> <span class="st">"top"</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-68-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="огибающая" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Огибающая</h1>
<p>Модель: <span class="math display">\[
x_n=A(n)\cos(2\pi\omega n).
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>cos10 <span class="ot">&lt;-</span> <span class="fu">em_harmonic</span>(N, <span class="fl">0.1</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>envelope <span class="ot">&lt;-</span> <span class="fu">em_harmonic</span>(N, <span class="fl">0.004</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>x_envelope <span class="ot">&lt;-</span> <span class="fu">ts</span>(envelope <span class="sc">*</span> cos10)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(x_envelope)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-69-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Оценим огибающую <span class="math inline">\(A(n)\)</span>. Возведем ряд в квадрат и домножим на <span class="math inline">\(2\)</span>: <span class="math display">\[
y_n = 2x_n^2=2 A(n)\cos^2(2\pi n/10)=A^2(n) + A^2(n)\cos(2 \pi n / 10).
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>y_envelope <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> x_envelope<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(y_envelope)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-70-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Осталось только выделить тренд у полученного ряда.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>s_envelope <span class="ot">&lt;-</span> <span class="fu">ssa</span>(y_envelope)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_envelope, <span class="st">"vectors"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-71-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>В нашем случае ранг <span class="math inline">\(A^2(n)=\cos^2(2 \pi n / 500)\)</span> равен 3.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>r_envelope <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(s_envelope, <span class="fu">list</span>(<span class="at">Envelope =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>)))</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(x_envelope, <span class="fu">sqrt</span>(r_envelope<span class="sc">$</span>Envelope)),</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"Envelope"</span>), <span class="at">space =</span> <span class="st">"top"</span>),</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-72-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="гетероскедастичный-шум" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Гетероскедастичный шум</h1>
<p>Построим доверительный интервал гетероскедастичного шума, задающегося формулой <span class="math display">\[
\mathsf{X}=\sigma(n)\varepsilon_n,
\]</span> где <span class="math inline">\(\sigma(n)\)</span> — медленно меняющаяся функция, <span class="math inline">\(\varepsilon_n\)</span> — белый гауссовский шум.</p>
<p>Пусть дисперсия шума меняется линейно:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">ts</span>((<span class="dv">1</span><span class="sc">:</span>N) <span class="sc">*</span> wn)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(x)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-73-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Возведем его в квадрат:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(y)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-74-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Выделим тренд:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">ssa</span>(y)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="st">"vectors"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-75-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(s, <span class="fu">list</span>(<span class="at">Trend =</span> <span class="dv">1</span>))</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(r, <span class="at">plot.method =</span> <span class="st">"xyplot"</span>, <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">superpose =</span> <span class="cn">TRUE</span>, <span class="at">add.residuals =</span> <span class="cn">FALSE</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-76-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Построим доверительный интервал <span class="math inline">\(\pm2\sqrt{\hat\sigma^2(n)}\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(x, <span class="dv">2</span> <span class="sc">*</span> <span class="fu">sqrt</span>(r<span class="sc">$</span>Trend), <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">sqrt</span>(r<span class="sc">$</span>Trend)),</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"#0072B2"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#E69F00"</span>),</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"Confidence interval"</span>), <span class="at">space =</span> <span class="st">"top"</span>)</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-77-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="loess-и-фильтр-hodrick-prescott" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> LOESS и фильтр Hodrick-Prescott</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>hp_debit <span class="ot">&lt;-</span> <span class="fu">hpfilter</span>(debit_log, <span class="dv">100</span> <span class="sc">*</span> <span class="dv">12</span><span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>loess_debit <span class="ot">&lt;-</span> <span class="fu">loess</span>(debit_log <span class="sc">~</span> <span class="fu">time</span>(debit_log), <span class="at">span =</span> <span class="fl">0.3</span>, <span class="at">degree =</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="st">"gaussian"</span>)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(debit_log, hp_debit<span class="sc">$</span>trend, loess_debit<span class="sc">$</span>fitted),</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"grey"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>),</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"HP filter"</span>, <span class="st">"LOESS"</span>))</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-78-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>hp_NileMin <span class="ot">&lt;-</span> <span class="fu">hpfilter</span>(NileMin, <span class="fl">1e+5</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>loess_NileMin <span class="ot">&lt;-</span> <span class="fu">loess</span>(NileMin <span class="sc">~</span> <span class="fu">time</span>(NileMin), <span class="at">span =</span> <span class="fl">0.15</span>, <span class="at">degree =</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="st">"gaussian"</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(NileMin, hp_NileMin<span class="sc">$</span>trend, loess_NileMin<span class="sc">$</span>fitted),</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"grey"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>),</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"HP filter"</span>, <span class="st">"LOESS"</span>))</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-79-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Для обоих рядов получили примерно одинаковые тренды, однако у фильтра HP получилась более плавная кривая.</p>
</section>
<section id="преобразование-бокса-кокса" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Преобразование Бокса-Кокса</h1>
<p>Применим преобразование на нелогарифмированных данных о использовании дебетовых картах.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>(lambda_debit <span class="ot">&lt;-</span> <span class="fu">BoxCox.lambda</span>(debitcards))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0.2292876</code></pre>
</div>
</div>
<p>Значение <span class="math inline">\(\lambda\)</span> ближе к <span class="math inline">\(0\)</span>, чем к <span class="math inline">\(1\)</span>, что говорит о мультипликативности модели. После применения преобразования видна стабилизация дисперсии ряда:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>debit_transformed <span class="ot">&lt;-</span> <span class="fu">BoxCox</span>(debitcards, lambda_debit)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(debitcards, <span class="at">main =</span> <span class="st">"Original"</span>),</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(debit_transformed, <span class="at">main =</span> <span class="st">"Transformed"</span>),</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">2</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-81-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ssa-с-процекцией" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> SSA с процекцией</h1>
<p>Известно, что линейный тренд неотделим от косинуса.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">71</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>N) <span class="sc">+</span> <span class="fu">em_harmonic</span>(N, freq[<span class="dv">1</span>], <span class="dv">10</span>)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">ssa</span>(x, L)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="st">"vectors"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-82-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Видно, что <span class="math inline">\(2\)</span>-я компонента смешалась с <span class="math inline">\(4\)</span>-й. С помощью SSA с проекцией можно добиться разделимости.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>s_proj <span class="ot">&lt;-</span> <span class="fu">ssa</span>(x, L, <span class="at">column.projector =</span> <span class="dv">1</span>, <span class="at">row.projector =</span> <span class="dv">1</span>)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_proj, <span class="st">"vectors"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-83-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">wcor</span>(s_proj, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-83-2.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Действительно, теперь <span class="math inline">\(1\)</span> и <span class="math inline">\(2\)</span> компоненты соответствуют тренду, а <span class="math inline">\(3\)</span> и <span class="math inline">\(4\)</span> — гармонике.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reconstruct</span>(s_proj, <span class="fu">list</span>(<span class="at">Trend =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">Harmonic =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.method =</span> <span class="st">"xyplot"</span>,</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">add.residuals =</span> <span class="cn">FALSE</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-84-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="автоматическая-группировка-в-ssa" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Автоматическая группировка в SSA</h1>
<p>С помощью <code>grouping.auto</code> автоматически выделим тренд и сезонную составляющую:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">length</span>(debit_log)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>freq.bins <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span> <span class="sc">/</span> <span class="dv">12</span>, <span class="cf">function</span>(freq) freq <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span>delta, delta))</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>freq.bins[[<span class="dv">7</span>]] <span class="ot">&lt;-</span> <span class="fl">0.02</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(freq.bins) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"S"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>), <span class="st">"Trend"</span>)</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>(g_debit <span class="ot">&lt;-</span> <span class="fu">grouping.auto</span>(s_debit, <span class="at">freq.bins =</span> freq.bins, <span class="at">threshold =</span> <span class="fl">0.5</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## $S1
## [1] 6 8
## 
## $S2
## [1] 3 4
## 
## $S3
## [1] 10 11
## 
## $S4
## [1] 12 13
## 
## $S5
## [1] 7 9
## 
## $S6
## [1] 14
## 
## $Trend
## [1]  1  2  5 17
## 
## attr(,"contributions")
##              S1           S2           S3           S4           S5
## 1  7.149622e-06 1.821456e-06 9.008490e-07 5.940891e-07 2.363522e-07
## 2  4.312357e-04 1.368391e-04 6.421864e-05 4.189780e-05 1.824973e-05
## 3  2.241320e-03 8.882264e-01 6.425917e-03 1.299284e-03 1.081760e-03
## 4  2.396542e-03 9.547177e-01 4.537458e-05 2.347889e-05 1.110694e-05
## 5  2.764348e-03 5.651100e-04 8.309096e-04 9.924169e-05 7.917659e-04
## 6  7.056205e-01 2.510368e-03 1.686964e-02 1.545543e-03 8.210470e-02
## 7  2.571305e-01 8.893333e-04 1.041260e-03 1.735583e-03 6.673560e-01
## 8  8.972495e-01 2.133772e-04 1.944357e-04 8.195927e-04 4.286309e-02
## 9  2.181521e-03 1.133496e-05 2.786337e-03 4.067093e-04 9.557750e-01
## 10 8.394401e-03 4.632515e-04 9.732723e-01 2.130526e-04 2.614842e-04
## 11 2.888588e-04 4.138370e-04 9.686669e-01 2.009613e-04 2.549267e-03
## 12 1.019390e-05 2.999839e-05 9.539865e-05 9.788045e-01 4.724084e-04
## 13 2.092217e-06 2.645405e-06 8.390179e-06 9.408327e-01 9.084307e-04
## 14 4.260160e-06 7.028858e-06 1.365645e-05 1.511507e-05 1.640263e-04
## 15 9.738300e-03 2.119155e-03 1.338379e-03 1.082818e-03 3.810082e-04
## 16 1.592273e-03 3.361190e-04 1.989521e-04 1.620805e-04 8.019018e-05
## 17 7.696486e-03 1.329773e-03 7.495252e-04 5.994922e-04 1.521027e-04
## 18 4.345200e-05 2.246338e-04 9.272279e-04 1.340431e-02 2.382073e-03
## 19 1.853304e-05 8.046677e-05 4.961840e-04 1.656925e-02 4.739046e-04
## 20 5.464169e-03 4.380240e-03 1.007958e-02 1.019492e-03 3.163324e-03
## 21 2.970425e-04 1.601539e-04 1.475821e-02 3.111173e-03 5.405492e-03
## 22 1.124084e-02 4.424772e-04 4.905902e-03 2.282761e-04 1.212316e-03
## 23 1.070747e-03 7.293054e-05 1.914292e-03 5.937953e-06 5.530199e-03
## 24 4.166982e-03 4.144674e-05 7.257682e-03 5.986244e-05 2.037900e-04
## 25 7.234977e-05 2.257355e-04 1.306115e-02 1.252302e-04 1.609947e-05
## 26 2.471497e-01 3.190345e-05 3.392664e-03 3.761885e-05 7.998607e-05
## 27 2.972322e-01 7.931684e-06 4.982919e-06 2.083372e-07 7.945798e-07
## 28 7.948088e-03 5.650432e-05 1.157688e-05 1.342109e-06 1.067147e-07
## 29 3.283792e-03 2.668129e-03 4.644679e-03 9.823175e-04 5.209258e-04
## 30 3.675527e-04 1.086959e-03 2.562483e-03 4.134343e-03 7.722356e-04
## 31 1.031900e-05 3.411402e-05 9.531044e-05 2.813866e-04 6.542379e-04
## 32 2.720299e-02 2.165703e-03 2.146714e-04 4.308365e-04 1.867583e-04
## 33 6.916222e-04 2.645218e-03 6.320776e-02 1.145383e-03 1.182927e-04
## 34 1.358486e-04 2.846813e-04 4.818252e-02 2.024304e-02 2.148039e-03
## 35 3.489515e-03 3.119402e-03 9.711101e-03 1.021659e-02 1.801685e-02
## 36 8.913114e-03 1.947669e-03 6.850682e-05 1.418346e-05 5.984207e-05
## 37 4.076253e-03 1.023745e-02 2.742390e-03 1.585293e-04 1.390309e-05
## 38 9.569730e-05 2.780978e-03 6.478664e-02 9.604557e-03 2.558894e-02
## 39 2.096699e-04 3.183490e-04 2.994309e-02 3.919032e-04 9.373166e-04
## 40 1.883157e-04 2.329456e-04 2.236637e-03 8.951887e-04 1.440730e-02
## 41 9.862472e-05 4.851757e-05 4.552388e-02 4.661586e-03 2.931628e-03
## 42 1.268427e-05 5.230213e-06 4.871418e-03 9.188555e-04 6.921079e-04
## 43 2.432670e-03 1.140142e-03 3.265860e-03 1.431290e-03 1.486685e-03
## 44 1.762254e-07 1.974953e-07 1.691797e-06 2.684211e-06 6.049456e-04
## 45 2.923690e-04 4.576097e-04 4.463688e-04 1.202487e-03 7.743538e-04
## 46 3.400577e-04 6.971703e-04 1.917266e-03 3.002776e-02 2.609915e-04
## 47 6.457895e-08 2.673937e-06 4.437733e-05 5.091804e-03 3.136667e-03
## 48 1.710450e-04 9.056578e-05 8.037186e-04 4.982618e-04 5.828874e-04
## 49 1.440022e-04 2.557067e-03 3.084562e-04 1.360360e-04 3.059800e-05
## 50 2.964151e-02 1.471053e-02 1.552038e-04 4.081738e-04 2.324617e-04
##              S6        Trend
## 1  1.104922e-07 9.998474e-01
## 2  8.131190e-06 9.952863e-01
## 3  2.408815e-04 7.169490e-03
## 4  5.267242e-06 1.641197e-03
## 5  2.313542e-05 9.850747e-01
## 6  1.070708e-03 2.798187e-02
## 7  8.531243e-04 8.686916e-05
## 8  4.531191e-06 4.558453e-03
## 9  1.151931e-03 4.206433e-05
## 10 2.830878e-06 4.606930e-05
## 11 2.521141e-04 3.094682e-04
## 12 1.039160e-03 1.909300e-05
## 13 4.885889e-04 3.240515e-06
## 14 9.574540e-01 7.018776e-06
## 15 1.759021e-04 5.403263e-02
## 16 3.213332e-05 2.564069e-03
## 17 3.590573e-05 7.228231e-01
## 18 6.470086e-04 8.388715e-04
## 19 1.347715e-04 2.049923e-03
## 20 3.461663e-03 4.327324e-03
## 21 2.898924e-04 2.486823e-05
## 22 5.045932e-05 6.993849e-04
## 23 1.182260e-03 1.809331e-05
## 24 1.460453e-06 6.818420e-07
## 25 7.568365e-07 8.574191e-06
## 26 7.922787e-06 2.158568e-05
## 27 2.295415e-07 1.556270e-05
## 28 1.984921e-07 9.781728e-05
## 29 3.023559e-04 2.378838e-04
## 30 1.640998e-04 4.341431e-04
## 31 2.650487e-04 4.782942e-06
## 32 1.078032e-04 5.038004e-02
## 33 1.140459e-04 8.444745e-04
## 34 7.572012e-04 1.332102e-03
## 35 1.925975e-03 8.226331e-03
## 36 6.240810e-04 2.886059e-03
## 37 8.246203e-06 7.097291e-04
## 38 9.540568e-04 2.063156e-05
## 39 6.424187e-04 4.721496e-04
## 40 6.525577e-03 2.017577e-04
## 41 4.081911e-03 1.079151e-05
## 42 5.294582e-04 8.199733e-06
## 43 3.723905e-04 3.721040e-03
## 44 2.098784e-02 2.178011e-07
## 45 3.507453e-04 6.455669e-04
## 46 1.091058e-04 3.481847e-04
## 47 1.441011e-05 1.700517e-08
## 48 3.171320e-05 1.351277e-04
## 49 2.416530e-05 7.042003e-05
## 50 1.290499e-04 1.819525e-02
## attr(,"type")
## [1] "independent"
## attr(,"threshold")
## [1] 0.5 0.5 0.5 0.5 0.5 0.5 0.5
## attr(,"class")
## [1] "grouping.auto.pgram"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">reconstruct</span>(s_debit, g_debit), <span class="at">add.residuals =</span> <span class="cn">FALSE</span>, <span class="at">plot.method =</span> <span class="st">"xyplot"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-85-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="derivssa" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> DerivSSA</h1>
<p>Воспользуемся <code>fossa</code>, чтобы улучшить разделимость гармонических компонент. Ряд с огибающей:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(x_envelope)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-86-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_envelope, <span class="st">"vectors"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-87-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">wcor</span>(s_envelope, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-87-2.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p><span class="math inline">\(4\)</span>-я компонента смешалась со <span class="math inline">\(2\)</span>-й <span class="math inline">\(3\)</span>-й. Применяем <code>fossa</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>fs_envelope <span class="ot">&lt;-</span> <span class="fu">fossa</span>(s_envelope, <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fs_envelope, <span class="st">"vectors"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-88-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">wcor</span>(fs_envelope, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-88-2.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>rfs_envelope <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(fs_envelope, <span class="fu">list</span>(<span class="at">Envelope =</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>))) </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(x_envelope, <span class="fu">sqrt</span>(r_envelope<span class="sc">$</span>Envelope), <span class="fu">sqrt</span>(rfs_envelope<span class="sc">$</span>Envelope)),</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"Basic SSA"</span>, <span class="st">"DerivSSA"</span>), <span class="at">space =</span> <span class="st">"top"</span>)</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-89-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Получили практически идеальную огибающую.</p>
<p>Теперь перейдем к данным по использованию дебетовых карт. Как было до:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_debit, <span class="st">"vectors"</span>, <span class="at">idx =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-90-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">wcor</span>(s_debit, <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-90-2.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>После:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>fs_debit <span class="ot">&lt;-</span> <span class="fu">fossa</span>(s_debit, <span class="dv">5</span><span class="sc">:</span><span class="dv">11</span>)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fs_debit, <span class="st">"vectors"</span>, <span class="at">idx =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-91-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">wcor</span>(fs_debit, <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-91-2.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Видно, что разделимость усилилась, теперь приступим к автоматической группировке:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>g_debit <span class="ot">&lt;-</span> <span class="fu">grouping.auto</span>(fs_debit, <span class="at">freq.bins =</span> freq.bins, <span class="at">threshold =</span> <span class="fl">0.5</span>)</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">reconstruct</span>(fs_debit, g_debit), <span class="at">add.residuals =</span> <span class="cn">FALSE</span>, <span class="at">plot.method =</span> <span class="st">"xyplot"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-92-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="линейно-рекурентные-формулы" class="level1" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> Линейно-рекурентные формулы</h1>
<section id="ряды-без-шума" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="ряды-без-шума"><span class="header-section-number">13.1</span> Ряды без шума</h2>
<p>Возьмем <span class="math inline">\(x_n=\cos(2 \pi n/ 5 + \pi / 4)\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">99</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>signal2 <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">em_harmonic</span>(N, <span class="at">freq =</span> <span class="fl">0.2</span>, <span class="at">phase =</span> pi <span class="sc">/</span> <span class="dv">4</span>))</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="fu">find_lrr</span>(signal2, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Periodic components:
##  coef * modulus^n * n^(order-1) * cos(2 * pi * n / period + phase)
##   period     phase coef modulus order
## 1      5 0.7853982    1       1     1</code></pre>
</div>
</div>
<p>Теперь возьмем многочлен <span class="math inline">\(2\)</span> степени: <span class="math inline">\(x_n=n^2+2n+5\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">find_lrr</span>((<span class="dv">1</span><span class="sc">:</span>N)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span>N) <span class="sc">+</span> <span class="dv">5</span>, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">tol =</span> <span class="fl">1e-4</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Trend components:
##  coef * modulus^n * n^(order-1)
##   coef modulus order
## 1    5       1     1
## 2    2       1     2
## 3    1       1     3</code></pre>
</div>
</div>
<p>Последовательность Фибоначчи: <span class="math inline">\(F_n=F_{n-1}+F_{n-2}\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">find_lrr</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Trend components:
##  coef * modulus^n * n^(order-1)
##        coef  modulus order
## 1 0.4472136 1.618034     1
## 
## Periodic components:
##  coef * modulus^n * n^(order-1) * cos(2 * pi * n / period + phase)
##   period phase       coef  modulus order
## 1      2     0 -0.4472136 0.618034     1</code></pre>
</div>
</div>
<p>Получили явную формулу: <span class="math display">\[
F_n = \frac{\left(\frac{1 + \sqrt{5}}{2}\right)^n-\left(\frac{1-\sqrt{5}}{2}\right)}{\sqrt{5}}.
\]</span> Первые <span class="math inline">\(10\)</span> чисел Фибоначчи:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_lrr</span>(l, <span class="dv">10</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  [1]  1  1  2  3  5  8 13 21 34 55</code></pre>
</div>
</div>
<p>Сигнал ранга <span class="math inline">\(7\)</span> с кратными корнями: <span class="math display">\[
x_n=0.1n\cdot e^{0.025 n}\cos(2 \pi n / 10 + \pi / 2) + n\cdot e^{0.02n} + 10\cdot(-1)^n.
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>signal7 <span class="ot">&lt;-</span> <span class="fu">mapply</span>(em_harmonic, N, <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">0</span>, <span class="fl">0.5</span>), <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>), <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.02</span>, <span class="dv">0</span>), <span class="fu">c</span>(pi <span class="sc">/</span> <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>signal7 <span class="ot">&lt;-</span> <span class="fu">ts</span>((<span class="dv">1</span><span class="sc">:</span>N) <span class="sc">*</span> <span class="fu">rowSums</span>(signal7[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]) <span class="sc">+</span> signal7[, <span class="dv">3</span>])</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(signal7)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-98-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">find_lrr</span>(signal7, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Trend components:
##  coef * modulus^n * n^(order-1)
##            coef  modulus order
## 1 -1.129006e-10 1.020201     1
## 2  1.000000e+00 1.020201     2
## 
## Periodic components:
##  coef * modulus^n * n^(order-1) * cos(2 * pi * n / period + phase)
##   period    phase         coef  modulus order
## 1     10 1.032525 1.958805e-10 1.025315     1
## 2     10 1.570796 1.000000e-01 1.025315     2
## 3      2 0.000000 1.000000e+01 1.000000     1</code></pre>
</div>
</div>
</section>
<section id="ряды-с-шумом" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="ряды-с-шумом"><span class="header-section-number">13.2</span> Ряды с шумом</h2>
<p>Теперь добавим во временные ряды шум.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">ts</span>(signal2 <span class="sc">+</span> <span class="fu">rnorm</span>(N))</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> (N <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%/%</span> <span class="dv">2</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ssa</span>(x1, L), <span class="st">"vectors"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-100-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">find_lrr</span>(x1, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="at">L =</span> L)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Periodic components:
##  coef * modulus^n * n^(order-1) * cos(2 * pi * n / period + phase)
##     period     phase     coef   modulus order
## 1 4.991823 0.5467411 1.307025 0.9965079     1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>signal2_est <span class="ot">&lt;-</span> <span class="fu">generate_lrr</span>(l, N)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(x1, signal2, signal2_est),</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"grey"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>),</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"Signal"</span>, <span class="st">"LRR"</span>),</span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">space =</span> <span class="st">"top"</span></span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-101-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> signal7 <span class="sc">+</span> <span class="fu">rnorm</span>(N, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">ssa</span>(x2, L)</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="st">"vectors"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-102-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">find_lrr</span>(x2, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>), <span class="fl">1e-1</span>, <span class="at">L =</span> L)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Trend components:
##  coef * modulus^n * n^(order-1)
##        coef  modulus order
## 1 4.5719381 1.022112     1
## 2 0.8006677 1.022112     2
## 
## Periodic components:
##  coef * modulus^n * n^(order-1) * cos(2 * pi * n / period + phase)
##     period     phase       coef  modulus order
## 1 9.558335  1.612570 20.4914438 1.007702     1
## 2 9.558335 -1.149913  0.6222523 1.007702     2
## 3 2.000000  0.000000  9.3538127 1.000703     1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>signal7_est <span class="ot">&lt;-</span> <span class="fu">generate_lrr</span>(l, N)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(x2, signal7, signal7_est),</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"grey"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>),</span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"Signal"</span>, <span class="st">"LRR"</span>),</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">space =</span> <span class="st">"top"</span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-103-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="итерации-cadzow" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="итерации-cadzow"><span class="header-section-number">13.3</span> Итерации Cadzow</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>cadz <span class="ot">&lt;-</span> <span class="fu">cadzow</span>(<span class="fu">ssa</span>(x1, L), <span class="at">rank =</span> <span class="dv">2</span>)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">find_lrr</span>(cadz, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Periodic components:
##  coef * modulus^n * n^(order-1) * cos(2 * pi * n / period + phase)
##     period     phase     coef  modulus order
## 1 4.991186 0.4901042 1.148965 0.998917     1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(x1, signal2, signal2_est, <span class="fu">generate_lrr</span>(l, N)),</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"grey"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"orange"</span>),</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"Signal"</span>, <span class="st">"LRR"</span>, <span class="st">"LRR (Cadzow)"</span>),</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">space =</span> <span class="st">"top"</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-104-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>cadz <span class="ot">&lt;-</span> <span class="fu">cadzow</span>(s, <span class="at">rank =</span> <span class="dv">7</span>)</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">find_lrr</span>(cadz, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>), <span class="fl">1e-1</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Trend components:
##  coef * modulus^n * n^(order-1)
##        coef  modulus order
## 1 0.2552370 1.022752     1
## 2 0.9010348 1.022752     2
## 
## Periodic components:
##  coef * modulus^n * n^(order-1) * cos(2 * pi * n / period + phase)
##     period     phase       coef  modulus order
## 1 9.832848 -2.576600 0.51778788 1.029397     1
## 2 9.832848  1.046366 0.09722059 1.029397     2
## 3 2.000000  0.000000 9.59245572 1.000489     1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(x2, signal7, signal7_est, <span class="fu">generate_lrr</span>(l, N)),</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"grey"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"orange"</span>),</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"Signal"</span>, <span class="st">"LRR"</span>, <span class="st">"LRR (Cadzow)"</span>),</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">space =</span> <span class="st">"top"</span></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-105-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="реальные-данные-3" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="реальные-данные-3"><span class="header-section-number">13.4</span> Реальные данные</h2>
<section id="звездная-величина-2" class="level3" data-number="13.4.1">
<h3 data-number="13.4.1" class="anchored" data-anchor-id="звездная-величина-2"><span class="header-section-number">13.4.1</span> Звездная величина</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>lrr_star <span class="ot">&lt;-</span> <span class="fu">find_lrr</span>(star, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>), <span class="at">L =</span> <span class="dv">300</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Trend components:
##  coef * modulus^n * n^(order-1)
##       coef modulus order
## 1 17.08536       1     1
## 
## Periodic components:
##  coef * modulus^n * n^(order-1) * cos(2 * pi * n / period + phase)
##      period      phase        coef   modulus order
## 1 29.000385 -0.9201414 10.03231466 0.9999996     1
## 2 24.000350 -1.8316651  7.08328917 1.0000005     1
## 3  4.006397  2.2820793  0.17480931 0.9993565     1
## 4  2.000000  0.0000000 -0.09289724 0.9997528     1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(star, <span class="fu">generate_lrr</span>(lrr_star, <span class="fu">length</span>(star))),</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"grey"</span>, <span class="st">"red"</span>),</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"LRR"</span>),</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">space =</span> <span class="st">"top"</span></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-106-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="дебетовые-карты-2" class="level3" data-number="13.4.2">
<h3 data-number="13.4.2" class="anchored" data-anchor-id="дебетовые-карты-2"><span class="header-section-number">13.4.2</span> Дебетовые карты</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>lrr_debit <span class="ot">&lt;-</span> <span class="fu">find_lrr</span>(debit_log, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>), <span class="at">L =</span> <span class="dv">72</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Trend components:
##  coef * modulus^n * n^(order-1)
##         coef   modulus order
## 1  9.3078532 1.0004711     1
## 2 -0.4863133 0.8959641     1
## 
## Periodic components:
##  coef * modulus^n * n^(order-1) * cos(2 * pi * n / period + phase)
##       period       phase       coef   modulus order
## 1 108.553080  1.25683993 0.39214658 0.9802381     1
## 2  26.110282  2.90452136 0.01428862 1.0021357     1
## 3  11.949408  1.69862902 0.05174943 1.0026616     1
## 4   6.007907  0.05996315 0.06774916 1.0001200     1
## 5   3.993595 -0.07329578 0.07002082 0.9982916     1
## 6   2.995728  0.07796689 0.04960291 0.9998363     1
## 7   2.400701 -0.43360236 0.05821820 1.0006862     1
## 8   2.000000  0.00000000 0.03260017 0.9970358     1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(debit_log, <span class="fu">generate_lrr</span>(lrr_debit, <span class="fu">length</span>(debit_log))),</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"grey"</span>, <span class="st">"red"</span>),</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"LRR"</span>),</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">space =</span> <span class="st">"top"</span></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-107-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="уровень-воды-реки-нил-1" class="level3" data-number="13.4.3">
<h3 data-number="13.4.3" class="anchored" data-anchor-id="уровень-воды-реки-нил-1"><span class="header-section-number">13.4.3</span> Уровень воды реки Нил</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>lrr_NileMin <span class="ot">&lt;-</span> <span class="fu">find_lrr</span>(NileMin, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">L =</span> <span class="dv">332</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Trend components:
##  coef * modulus^n * n^(order-1)
##       coef  modulus order
## 1 1076.205 1.000196     1
## 
## Periodic components:
##  coef * modulus^n * n^(order-1) * cos(2 * pi * n / period + phase)
##     period      phase     coef  modulus order
## 1 237.9421 -0.6652448 52.17252 1.000337     1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(NileMin, <span class="fu">generate_lrr</span>(lrr_NileMin, <span class="fu">length</span>(NileMin))),</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"grey"</span>, <span class="st">"red"</span>),</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(</span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"LRR"</span>),</span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">space =</span> <span class="st">"top"</span></span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-108-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="iterative-o-ssa" class="level1" data-number="14">
<h1 data-number="14"><span class="header-section-number">14</span> Iterative O-SSA</h1>
<p>Возьмем сумму трех гармоник с близкими частотами.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">mapply</span>(em_harmonic, N, <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.092</span>, <span class="fl">0.15</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span> <span class="fu">rowSums</span>()</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">ts</span>(x <span class="sc">+</span> <span class="fl">0.1</span> <span class="sc">*</span> <span class="fu">rnorm</span>(N))</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">ssa</span>(x)</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="st">"vectors"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-109-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>По графикам собственных векторов видно, что пара <span class="math inline">\(5\)</span>-<span class="math inline">\(6\)</span> смешалась с остальными компонентами. Вклад у компонент разный, поэтому DerivSSA тут не поможет. Применим <code>iossa</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>ios <span class="ot">&lt;-</span> <span class="fu">iossa</span>(s, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>))</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ios, <span class="st">"vectors"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning in .contribution(x, idx, ...): Elementary matrices are not F-orthogonal
## (max F-cor is -0.45). Contributions can be irrelevant</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-110-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reconstruct</span>(ios, ios<span class="sc">$</span>iossa.groups),</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.method =</span> <span class="st">"xyplot"</span>,</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">add.original =</span> <span class="cn">FALSE</span>,</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">add.residuals =</span> <span class="cn">FALSE</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-111-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Можно вспомнить пример с экспонентой и константой:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">em_harmonic</span>(N, <span class="dv">0</span>, <span class="at">a =</span> <span class="fl">0.02</span>) <span class="sc">+</span> <span class="dv">10</span>)</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">ssa</span>(x)</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>ios <span class="ot">&lt;-</span> <span class="fu">iossa</span>(s, <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reconstruct</span>(ios, ios<span class="sc">$</span>iossa.groups),</span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.method =</span> <span class="st">"xyplot"</span>,</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">add.residuals =</span> <span class="cn">FALSE</span>,</span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">space =</span> <span class="st">"top"</span>)</span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-112-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="esprit-motivated-o-ssa" class="level1" data-number="15">
<h1 data-number="15"><span class="header-section-number">15</span> Esprit-motivated O-SSA</h1>
<p>Усилим разделимость с помощью <code>eossa_new</code>.</p>
<section id="модельные-ряды" class="level2" data-number="15.1">
<h2 data-number="15.1" class="anchored" data-anchor-id="модельные-ряды"><span class="header-section-number">15.1</span> Модельные ряды</h2>
<p>Возьмем те же ряды, на которых проверяли IOSSA.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">mapply</span>(em_harmonic, N, <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.092</span>, <span class="fl">0.15</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span> <span class="fu">rowSums</span>()</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">ts</span>(x <span class="sc">+</span> <span class="fl">0.1</span> <span class="sc">*</span> <span class="fu">rnorm</span>(N))</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">ssa</span>(x)</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>eos <span class="ot">&lt;-</span> <span class="fu">eossa_new</span>(s, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">clust_type =</span> <span class="st">"distance"</span>)</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">reconstruct</span>(eos, eos<span class="sc">$</span>iossa.groups), <span class="at">plot.method =</span> <span class="st">"xyplot"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-113-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">em_harmonic</span>(N, <span class="dv">0</span>, <span class="at">a =</span> <span class="fl">0.02</span>) <span class="sc">+</span> <span class="dv">10</span>)</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">ssa</span>(x)</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>eos <span class="ot">&lt;-</span> <span class="fu">eossa_new</span>(s, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">clust_type =</span> <span class="st">"distance"</span>)</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reconstruct</span>(eos, eos<span class="sc">$</span>iossa.groups),</span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.method =</span> <span class="st">"xyplot"</span>,</span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">add.residuals =</span> <span class="cn">FALSE</span>,</span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">space =</span> <span class="st">"top"</span>)</span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-114-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="реальные-данные-4" class="level2" data-number="15.2">
<h2 data-number="15.2" class="anchored" data-anchor-id="реальные-данные-4"><span class="header-section-number">15.2</span> Реальные данные</h2>
<section id="дебетовые-карты-3" class="level3" data-number="15.2.1">
<h3 data-number="15.2.1" class="anchored" data-anchor-id="дебетовые-карты-3"><span class="header-section-number">15.2.1</span> Дебетовые карты</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_debit, <span class="st">"vectors"</span>, <span class="at">idx =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-115-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>eos_debit <span class="ot">&lt;-</span> <span class="fu">eossa_new</span>(s_debit, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>, <span class="dv">17</span>), <span class="at">clust_type =</span> <span class="st">"distance"</span>)</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(eos_debit, <span class="st">"vectors"</span>, <span class="at">idx =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning in .contribution(x, idx, ...): Elementary matrices are not F-orthogonal
## (max F-cor is -0.193). Contributions can be irrelevant</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-115-2.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>reos_debit <span class="ot">&lt;-</span>  <span class="fu">reconstruct</span>(eos_debit, <span class="fu">list</span>(<span class="at">Trend =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">Seasonality =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">14</span>, <span class="dv">17</span>)))</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>  reos_debit,</span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.method =</span> <span class="st">"xyplot"</span>,</span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">add.residuals =</span> <span class="cn">FALSE</span></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-116-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Сравним тренд с тренд и сезонность, полученных с помощью EOSSA и Basic SSA:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(debit_log, r_debit<span class="sc">$</span>Trend, reos_debit<span class="sc">$</span>Trend),</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"SSA"</span>, <span class="st">"EOSSA"</span>), <span class="at">space =</span> <span class="st">"top"</span>)</span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-117-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(r_debit<span class="sc">$</span>Seasonality, reos_debit<span class="sc">$</span>Seasonality),</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">superpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="fu">c</span>(<span class="st">"SSA"</span>, <span class="st">"EOSSA"</span>), <span class="at">space =</span> <span class="st">"top"</span>)</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-118-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="classical-seasonal-decomposition-и-stl" class="level1" data-number="16">
<h1 data-number="16"><span class="header-section-number">16</span> Classical seasonal decomposition и STL</h1>
<p>Выкинем из ряда два периода, это понадобится нам в дальнейшем при проверке качества прогноза. Будем сравнивать результаты <code>decompose</code> и <code>stl</code> с результатом EOSSA.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>debit_trunc <span class="ot">&lt;-</span> <span class="fu">window</span>(debitcards, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2010</span>, <span class="dv">12</span>))</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>s_debit <span class="ot">&lt;-</span> <span class="fu">ssa</span>(debit_trunc, <span class="at">L =</span> <span class="dv">48</span>, <span class="at">svd.method =</span> <span class="st">"svd"</span>, <span class="at">neig =</span> <span class="dv">100</span>)</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_debit, <span class="st">"vectors"</span>, <span class="at">idx =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-119-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>eos_debit <span class="ot">&lt;-</span> <span class="fu">eossa_new</span>(s_debit, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>), <span class="st">"distance"</span>)</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(eos_debit, <span class="st">"vectors"</span>, <span class="at">idx =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning in .contribution(x, idx, ...): Elementary matrices are not F-orthogonal
## (max F-cor is -0.00759). Contributions can be irrelevant</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-119-2.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>reos_debit <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(eos_debit, <span class="fu">list</span>(<span class="at">Trend =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">Seasonality =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">14</span>))</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(reos_debit, <span class="at">plot.method =</span> <span class="st">"xyplot"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-119-3.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(reos_debit)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-120-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals
## Q* = 107.03, df = 24, p-value = 1.853e-12
## 
## Model df: 0.   Total lags used: 24</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>decompose_debit <span class="ot">&lt;-</span> <span class="fu">decompose</span>(debit_trunc, <span class="at">type =</span> <span class="st">"multiplicative"</span>)</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(decompose_debit)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-121-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(decompose_debit<span class="sc">$</span>random)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-122-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals
## Q* = 42.434, df = 24, p-value = 0.01153
## 
## Model df: 0.   Total lags used: 24</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>stl_debit <span class="ot">&lt;-</span> <span class="fu">stl</span>(debit_trunc, <span class="at">s.window =</span> <span class="dv">7</span>, <span class="at">s.degree =</span> <span class="dv">1</span>, <span class="at">t.degree =</span> <span class="dv">1</span>, <span class="at">l.degree =</span> <span class="dv">1</span>)</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(stl_debit)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-123-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(stl_debit<span class="sc">$</span>time.series[, <span class="dv">3</span>])</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-124-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals
## Q* = 81.819, df = 24, p-value = 3.114e-08
## 
## Model df: 0.   Total lags used: 24</code></pre>
</div>
</div>
<p>Гипотеза об белом шуме остатков отверглась для всех трех методов. Это говорит нам, что либо в ряде еще что-то осталось, либо остатки не описываются моделью белого шума. Сравним выделенные тренды:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(debitcards, <span class="at">ylab =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(reos_debit<span class="sc">$</span>Trend, <span class="at">series =</span> <span class="st">"EOSSA"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(decompose_debit<span class="sc">$</span>trend, <span class="at">series =</span> <span class="st">"decompose"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(stl_debit<span class="sc">$</span>time.series[, <span class="dv">2</span>], <span class="at">series =</span> <span class="st">"STL"</span>, <span class="at">lwd =</span> <span class="dv">1</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-125-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ssa-прогнозирование" class="level1" data-number="17">
<h1 data-number="17"><span class="header-section-number">17</span> SSA прогнозирование</h1>
<p>Посмотрим на корни ЛРФ:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>(par <span class="ot">&lt;-</span> <span class="fu">parestimate</span>(eos_debit, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##    period     rate   |    Mod     Arg  |     Re        Im
##     2.995   0.008159 |  1.00819   2.10 | -0.50711   0.87138
##    -2.995   0.008159 |  1.00819  -2.10 | -0.50711  -0.87138
##     6.024   0.007795 |  1.00783   1.04 |  0.50758   0.87068
##    -6.024   0.007795 |  1.00783  -1.04 |  0.50758  -0.87068
##   112.486   0.007564 |  1.00759   0.06 |  1.00602   0.05625
##  -112.486   0.007564 |  1.00759  -0.06 |  1.00602  -0.05625
##    12.069   0.007434 |  1.00746   0.52 |  0.87399   0.50112
##   -12.069   0.007434 |  1.00746  -0.52 |  0.87399  -0.50112
##       Inf   0.007079 |  1.00710  -0.00 |  1.00710  -0.00000
##     3.992   0.006548 |  1.00657   1.57 | -0.00314   1.00656
##    -3.992   0.006548 |  1.00657  -1.57 | -0.00314  -1.00656
##     2.399   0.005881 |  1.00590   2.62 | -0.87155   0.50223
##    -2.399   0.005881 |  1.00590  -2.62 | -0.87155  -0.50223
##    -2.000   0.003466 |  1.00347  -3.14 | -1.00347  -0.00000</code></pre>
</div>
</div>
<p>Все корни по модулю больше <span class="math inline">\(1\)</span>, значит предсказание будет идти вверх. Убедимся в этом:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>rfor_debit <span class="ot">&lt;-</span> <span class="fu">rforecast</span>(eos_debit, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>), <span class="at">len =</span> <span class="dv">24</span>)</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>vfor_debit <span class="ot">&lt;-</span> <span class="fu">vforecast</span>(eos_debit, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>), <span class="at">len =</span> <span class="dv">24</span>)</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">tail</span>(debitcards, <span class="dv">36</span>), <span class="at">ylab =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(rfor_debit, <span class="at">series =</span> <span class="st">"rforecast"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(vfor_debit, <span class="at">series =</span> <span class="st">"vforecast"</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-127-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Корень из среднеквадратичной оценки предсказания:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>rmse <span class="ot">&lt;-</span> <span class="cf">function</span>(y_true, y_pred) <span class="fu">sqrt</span>(<span class="fu">mean</span>((y_true <span class="sc">-</span> y_pred)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>rmse_debit <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Method =</span> <span class="fu">c</span>(<span class="st">"SSA (recurrent)"</span>, <span class="st">"SSA (vector)"</span>),</span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE =</span> <span class="fu">c</span>(<span class="fu">rmse</span>(debitcards, rfor_debit), <span class="fu">rmse</span>(debitcards, vfor_debit)),</span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>rmse_debit <span class="sc">|&gt;</span> <span class="fu">arrange</span>(RMSE)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Method</th>
<th style="text-align: right;">RMSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SSA (recurrent)</td>
<td style="text-align: right;">1436.799</td>
</tr>
<tr class="even">
<td style="text-align: left;">SSA (vector)</td>
<td style="text-align: right;">2363.807</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Теперь предскажем отдельно тренд:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>rfor_debit_trend <span class="ot">&lt;-</span> <span class="fu">rforecast</span>(eos_debit, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">len =</span> <span class="dv">24</span>)</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>vfor_debit_trend <span class="ot">&lt;-</span> <span class="fu">vforecast</span>(eos_debit, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">len =</span> <span class="dv">24</span>)</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(debitcards, <span class="at">ylab =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(rfor_debit_trend, <span class="at">series =</span> <span class="st">"rforecast"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(vfor_debit_trend, <span class="at">series =</span> <span class="st">"vforecast"</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-129-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Только сезонность:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>rfor_debit_season <span class="ot">&lt;-</span> <span class="fu">rforecast</span>(eos_debit, <span class="fu">list</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">14</span>),  <span class="dv">24</span>)</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>vfor_debit_season <span class="ot">&lt;-</span> <span class="fu">vforecast</span>(eos_debit, <span class="fu">list</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">14</span>), <span class="dv">24</span>)</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(reos_debit<span class="sc">$</span>Seasonality, <span class="at">ylab =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(rfor_debit_season, <span class="at">series =</span> <span class="st">"rforecast"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(vfor_debit_season, <span class="at">series =</span> <span class="st">"vforecast"</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-130-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<section id="бутстреп-доверительныепредсказательные-интервалы" class="level2" data-number="17.1">
<h2 data-number="17.1" class="anchored" data-anchor-id="бутстреп-доверительныепредсказательные-интервалы"><span class="header-section-number">17.1</span> Бутстреп-доверительные/предсказательные интервалы</h2>
<p>Поскольку рекурентный прогноз оказался точнее, будем использовать именно его. Доверительные интервалы:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>fс_conf <span class="ot">&lt;-</span> <span class="fu">forecast</span>(s_debit, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>), <span class="dv">24</span>, <span class="at">interval =</span> <span class="st">"conf"</span>)</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fс_conf, <span class="at">flwd =</span> <span class="dv">1</span>, <span class="at">ylab =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(debitcards, <span class="at">color =</span> <span class="st">"black"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-131-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Предсказательные интервалы:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>fс_pred <span class="ot">&lt;-</span> <span class="fu">forecast</span>(s_debit, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>), <span class="dv">24</span>, <span class="at">interval =</span> <span class="st">"pred"</span>)</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fс_pred, <span class="at">flwd =</span> <span class="dv">1</span>, <span class="at">ylab =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(debitcards, <span class="at">color =</span> <span class="st">"black"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-132-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Предсказательные интервалы, как и ожидалось, шире, чем доверительные. Заметим, что предсказанные значения лежат ближе к нижней границе интервалов, а для доверительных интервалов некоторые значения лежат даже ниже ее. Можно делать прогноз тоже бутстрепом:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>fc_bootstrap <span class="ot">&lt;-</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(s_debit, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>), <span class="dv">24</span>, <span class="at">interval =</span> <span class="st">"pred"</span>, <span class="at">only.intervals =</span> <span class="cn">FALSE</span>)</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fc_bootstrap, <span class="at">flwd =</span> <span class="dv">1</span>, <span class="at">ylab =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(debitcards, <span class="at">color =</span> <span class="st">"black"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-133-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>rmse_debit <span class="ot">&lt;-</span> <span class="fu">add_row</span>(</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>  rmse_debit,</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Method =</span> <span class="fu">c</span>(<span class="st">"SSA (recurrent with bootstrap)"</span>),</span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE =</span> <span class="fu">rmse</span>(debitcards, fc_bootstrap<span class="sc">$</span>mean)</span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a>rmse_debit <span class="sc">|&gt;</span> <span class="fu">arrange</span>(RMSE)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Method</th>
<th style="text-align: right;">RMSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SSA (recurrent)</td>
<td style="text-align: right;">1436.799</td>
</tr>
<tr class="even">
<td style="text-align: left;">SSA (vector)</td>
<td style="text-align: right;">2363.807</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SSA (recurrent with bootstrap)</td>
<td style="text-align: right;">2845.190</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="работа-с-пропусками" class="level1" data-number="18">
<h1 data-number="18"><span class="header-section-number">18</span> Работа с пропусками</h1>
<p>Займемся заполнением пропусков. Вырежем кусочек временного ряда:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>debit_gapped <span class="ot">&lt;-</span> debitcards</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="fu">window</span>(debit_gapped, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2004</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2005</span>, <span class="dv">12</span>)) <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>debit_gap <span class="ot">&lt;-</span> <span class="fu">window</span>(debitcards, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2004</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2005</span>, <span class="dv">12</span>))</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(debit_gapped, <span class="at">ylab =</span> <span class="st">""</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-135-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<section id="sequential" class="level2" data-number="18.1">
<h2 data-number="18.1" class="anchored" data-anchor-id="sequential"><span class="header-section-number">18.1</span> Sequential</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">ssa</span>(debit_gapped, <span class="dv">48</span>, <span class="at">svd.method =</span> <span class="st">"svd"</span>)</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>eos <span class="ot">&lt;-</span> <span class="fu">eossa_new</span>(s, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>), <span class="st">"distance"</span>, <span class="at">delta =</span> <span class="fl">1e-5</span>)</span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>go <span class="ot">&lt;-</span> <span class="fu">gapfill</span>(eos, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="st">"original"</span>, <span class="st">"sequential"</span>)</span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">gapfill</span>(eos, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="st">"reconstructed"</span>, <span class="st">"sequential"</span>)</span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(debitcards, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">color =</span> <span class="st">"grey"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(go, <span class="at">series =</span> <span class="st">"original"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(g, <span class="at">series =</span> <span class="st">"reconstructed"</span>, <span class="at">lwd =</span> <span class="dv">1</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-136-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="simultaneous" class="level2" data-number="18.2">
<h2 data-number="18.2" class="anchored" data-anchor-id="simultaneous"><span class="header-section-number">18.2</span> Simultaneous</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>go <span class="ot">&lt;-</span> <span class="fu">gapfill</span>(eos, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="st">"original"</span>, <span class="st">"simultaneous"</span>)</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">gapfill</span>(eos, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="st">"reconstructed"</span>, <span class="st">"simultaneous"</span>)</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(debitcards, <span class="at">ylab =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(debit_gap, <span class="at">color =</span> <span class="st">"grey"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(go, <span class="at">series =</span> <span class="st">"original"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(g, <span class="at">series =</span> <span class="st">"reconstructed"</span>, <span class="at">lwd =</span> <span class="dv">1</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-137-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="iterative" class="level2" data-number="18.3">
<h2 data-number="18.3" class="anchored" data-anchor-id="iterative"><span class="header-section-number">18.3</span> Iterative</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>igo <span class="ot">&lt;-</span> <span class="fu">igapfill</span>(eos, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="at">base =</span> <span class="st">"original"</span>)</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>ig <span class="ot">&lt;-</span> <span class="fu">igapfill</span>(eos, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="at">base =</span> <span class="st">"reconstructed"</span>)</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(debit_gap, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">color =</span> <span class="st">"grey"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(igo, <span class="at">series =</span> <span class="st">"original"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(ig, <span class="at">series =</span> <span class="st">"reconstructed"</span>, <span class="at">lwd =</span> <span class="dv">1</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-138-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="сравнение-gapfill-и-igapfill" class="level2" data-number="18.4">
<h2 data-number="18.4" class="anchored" data-anchor-id="сравнение-gapfill-и-igapfill"><span class="header-section-number">18.4</span> Сравнение gapfill и igapfill</h2>
<section id="ряд-без-тренда" class="level3" data-number="18.4.1">
<h3 data-number="18.4.1" class="anchored" data-anchor-id="ряд-без-тренда"><span class="header-section-number">18.4.1</span> Ряд без тренда</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">length</span>(signal2)</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(signal2, <span class="at">ylab =</span> <span class="st">""</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-139-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting up parallel computing</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="fu">min</span>(<span class="dv">15</span>, <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoFuture</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>gapfill_errors <span class="ot">&lt;-</span> <span class="cf">function</span>(gap_idx, signal, groups, <span class="at">M =</span> <span class="dv">500</span>, ...) {</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>  mse <span class="ot">&lt;-</span> <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span>M) <span class="sc">%dorng%</span> {</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>    x_gap <span class="ot">&lt;-</span> signal <span class="sc">+</span> <span class="fu">rnorm</span>(N, ...)</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>    x_gap[gap_idx] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> <span class="fu">ssa</span>(x_gap, <span class="dv">30</span>, <span class="at">svd.method =</span> <span class="st">"svd"</span>)</span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a>    g_seq <span class="ot">&lt;-</span> <span class="fu">gapfill</span>(s, groups, <span class="at">method =</span> <span class="st">"sequential"</span>)</span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a>    g_simult <span class="ot">&lt;-</span> <span class="fu">gapfill</span>(s, groups, <span class="at">method =</span> <span class="st">"simultaneous"</span>)</span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a>    ig <span class="ot">&lt;-</span> <span class="fu">igapfill</span>(s, groups, <span class="at">maxiter =</span> <span class="dv">50</span>)</span>
<span id="cb186-10"><a href="#cb186-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb186-11"><a href="#cb186-11" aria-hidden="true" tabindex="-1"></a>    mse.gapfill_seq <span class="ot">&lt;-</span> <span class="fu">mean</span>((g_seq[gap_idx] <span class="sc">-</span> signal[gap_idx])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb186-12"><a href="#cb186-12" aria-hidden="true" tabindex="-1"></a>    mse.gapfill_simult <span class="ot">&lt;-</span> <span class="fu">mean</span>((g_simult[gap_idx] <span class="sc">-</span> signal[gap_idx])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb186-13"><a href="#cb186-13" aria-hidden="true" tabindex="-1"></a>    mse.igapfill <span class="ot">&lt;-</span> <span class="fu">mean</span>((ig[gap_idx] <span class="sc">-</span> signal[gap_idx])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb186-14"><a href="#cb186-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb186-15"><a href="#cb186-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(mse.gapfill_seq, mse.gapfill_simult, mse.igapfill)</span>
<span id="cb186-16"><a href="#cb186-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb186-17"><a href="#cb186-17" aria-hidden="true" tabindex="-1"></a>  mse <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, mse) <span class="sc">|&gt;</span> <span class="fu">data.frame</span>()</span>
<span id="cb186-18"><a href="#cb186-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(mse) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gapfill_seq"</span>, <span class="st">"gapfill_simult"</span>, <span class="st">"igapfill"</span>)</span>
<span id="cb186-19"><a href="#cb186-19" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(mse, <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb186-20"><a href="#cb186-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>“Дырка” в середине:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>mse_center1 <span class="ot">&lt;-</span> <span class="fu">gapfill_errors</span>(<span class="dv">45</span><span class="sc">:</span><span class="dv">54</span>, signal2, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="at">sd =</span> <span class="fl">0.5</span>)</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mse_center1) <span class="sc">+</span> <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(name, value)) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"MSE"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-142-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>“Дырка” в конце:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>mse_end1 <span class="ot">&lt;-</span> <span class="fu">gapfill_errors</span>(<span class="dv">90</span><span class="sc">:</span><span class="dv">99</span>, signal2, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="at">sd =</span> <span class="fl">0.5</span>)</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mse_end1) <span class="sc">+</span> <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(name, value)) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"MSE"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-143-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ряд-c-трендом" class="level3" data-number="18.4.2">
<h3 data-number="18.4.2" class="anchored" data-anchor-id="ряд-c-трендом"><span class="header-section-number">18.4.2</span> Ряд c трендом</h3>
<p>Рассмотрим уже знакомый нам сигнал ранга <span class="math inline">\(7\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(signal7, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">lwd =</span> <span class="dv">1</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-144-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>“Дырка” в середине:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>mse_center2 <span class="ot">&lt;-</span> <span class="fu">gapfill_errors</span>(<span class="dv">45</span><span class="sc">:</span><span class="dv">54</span>, signal7, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>), <span class="at">sd =</span> <span class="fl">0.5</span>)</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mse_center2) <span class="sc">+</span> <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> value)) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"MSE"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-145-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>“Дырка” в конце:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>mse_end2 <span class="ot">&lt;-</span> <span class="fu">gapfill_errors</span>(<span class="dv">90</span><span class="sc">:</span><span class="dv">99</span>, signal7, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>), <span class="at">sd =</span> <span class="fl">0.5</span>)</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mse_end2) <span class="sc">+</span> <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> value)) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"MSE"</span>) <span class="sc">+</span> <span class="fu">scale_y_log10</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-146-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Посмотрим, как выглядит заполнение пропусков (которое, вообще говоря, в данном случае является прогнозом):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> x2_gap <span class="ot">&lt;-</span> signal7 <span class="sc">+</span> <span class="fu">rnorm</span>(N, <span class="at">sd =</span> <span class="fl">0.5</span>)</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>x2_gap[<span class="dv">90</span><span class="sc">:</span><span class="dv">99</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">ssa</span>(x2_gap, <span class="dv">30</span>, <span class="at">svd.method =</span> <span class="st">"svd"</span>)</span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="st">"vectors"</span>, <span class="at">idx =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-147-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>g_seq <span class="ot">&lt;-</span> <span class="fu">gapfill</span>(s, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>), <span class="at">method =</span> <span class="st">"sequential"</span>)</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>g_simult <span class="ot">&lt;-</span> <span class="fu">gapfill</span>(s, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>), <span class="at">method =</span> <span class="st">"simultaneous"</span>)</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>ig <span class="ot">&lt;-</span> <span class="fu">igapfill</span>(s, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>), <span class="at">maxiter =</span> <span class="dv">50</span>)</span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(x2, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(g_seq, <span class="at">series =</span> <span class="st">"sequential"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(g_simult, <span class="at">series =</span> <span class="st">"simultaneous"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(ig, <span class="at">series =</span> <span class="st">"iterative"</span>, <span class="at">lwd =</span> <span class="dv">1</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-148-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="процессы-arima" class="level1" data-number="19">
<h1 data-number="19"><span class="header-section-number">19</span> Процессы ARIMA</h1>
<section id="модельные-ряды-1" class="level2" data-number="19.1">
<h2 data-number="19.1" class="anchored" data-anchor-id="модельные-ряды-1"><span class="header-section-number">19.1</span> Модельные ряды</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ar =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.1</span>)), <span class="at">n =</span> <span class="dv">10000</span>)</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(x, <span class="at">plot.type =</span> <span class="st">"partial"</span>, <span class="at">lag.max =</span> <span class="dv">50</span>, <span class="at">main =</span> <span class="st">"ARIMA(2, 0, 0)"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-149-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>У PACF значимых лагов <span class="math inline">\(2\)</span>, что соответствует реальной модели.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>(fit <span class="ot">&lt;-</span> <span class="fu">Arima</span>(x, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">include.mean =</span> <span class="cn">FALSE</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Series: x 
## ARIMA(2,0,0) with zero mean 
## 
## Coefficients:
##          ar1     ar2
##       0.6841  0.1113
## s.e.  0.0099  0.0099
## 
## sigma^2 = 0.9977:  log likelihood = -14177.4
## AIC=28360.8   AICc=28360.8   BIC=28382.43</code></pre>
</div>
</div>
<p>Модель также правильно определяется автоматически:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>(auto_fit <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(x, <span class="at">stationary =</span> <span class="cn">TRUE</span>, <span class="at">stepwise =</span> <span class="cn">FALSE</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Series: x 
## ARIMA(2,0,0) with zero mean 
## 
## Coefficients:
##          ar1     ar2
##       0.6841  0.1113
## s.e.  0.0099  0.0099
## 
## sigma^2 = 0.9977:  log likelihood = -14177.4
## AIC=28360.8   AICc=28360.8   BIC=28382.43</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ar =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.1</span>), <span class="at">ma =</span> <span class="fu">c</span>(<span class="fl">0.9</span>)), <span class="at">n =</span> <span class="dv">10000</span>)</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(x, <span class="at">plot.type =</span> <span class="st">"partial"</span>, <span class="at">lag.max =</span> <span class="dv">50</span>, <span class="at">main =</span> <span class="st">"ARIMA(2, 0, 1)"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-152-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>По ACF и PACF похоже на модель MA(3).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>(fit <span class="ot">&lt;-</span> <span class="fu">Arima</span>(x, <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">3</span>), <span class="at">include.mean =</span> <span class="cn">FALSE</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Series: x 
## ARIMA(0,0,3) with zero mean 
## 
## Coefficients:
##          ma1     ma2     ma3
##       1.3812  0.5699  0.1265
## s.e.  0.0098  0.0157  0.0098
## 
## sigma^2 = 0.9982:  log likelihood = -14180.03
## AIC=28368.05   AICc=28368.06   BIC=28396.89</code></pre>
</div>
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(fit, <span class="at">lag.max =</span> <span class="dv">50</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-153-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals from ARIMA(0,0,3) with zero mean
## Q* = 6.0302, df = 7, p-value = 0.5362
## 
## Model df: 3.   Total lags used: 10</code></pre>
</div>
</div>
<p>Применим <code>auto.arima</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>auto_fit <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(</span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>  x,</span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">max.p =</span> <span class="dv">3</span>, <span class="at">max.q =</span> <span class="dv">3</span>,</span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">stationary =</span> <span class="cn">TRUE</span>,</span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">stepwise =</span> <span class="cn">FALSE</span>,</span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">approximation =</span> <span class="cn">FALSE</span>,</span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">allowmean =</span> <span class="cn">FALSE</span></span>
<span id="cb204-9"><a href="#cb204-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  ARIMA(0,0,0) with zero mean     : 40222.91
##  ARIMA(0,0,1) with zero mean     : 30387.46
##  ARIMA(0,0,2) with zero mean     : 28527.76
##  ARIMA(0,0,3) with zero mean     : 28368.06
##  ARIMA(1,0,0) with zero mean     : 33604.95
##  ARIMA(1,0,1) with zero mean     : 28432.29
##  ARIMA(1,0,2) with zero mean     : 28368.35
##  ARIMA(1,0,3) with zero mean     : 28366.11
##  ARIMA(2,0,0) with zero mean     : 31199.61
##  ARIMA(2,0,1) with zero mean     : 28364.4
##  ARIMA(2,0,2) with zero mean     : 28366.32
##  ARIMA(2,0,3) with zero mean     : 28367.98
##  ARIMA(3,0,0) with zero mean     : 30162.9
##  ARIMA(3,0,1) with zero mean     : 28366.31
##  ARIMA(3,0,2) with zero mean     : 28368.29
## 
## 
## 
##  Best model: ARIMA(2,0,1) with zero mean</code></pre>
</div>
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>auto_fit</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Series: x 
## ARIMA(2,0,1) with zero mean 
## 
## Coefficients:
##          ar1      ar2     ma1
##       0.4844  -0.0908  0.8997
## s.e.  0.0109   0.0108  0.0048
## 
## sigma^2 = 0.9978:  log likelihood = -14178.2
## AIC=28364.4   AICc=28364.4   BIC=28393.24</code></pre>
</div>
</div>
<p>Модель подобралась верно, хотя значения IC для моделей довольно близки (<span class="math inline">\(28368.06\)</span> и <span class="math inline">\(28364.4\)</span>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ar =</span> <span class="fl">0.4</span>), <span class="at">n =</span> <span class="dv">1000</span>) <span class="sc">+</span> <span class="fl">0.1</span></span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(x)</span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(x, <span class="st">"partial"</span>, <span class="at">main =</span> <span class="st">"ARIMA(1, 1, 0) with drift"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-155-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Очевидно, что ряд нестационарный. Проверим ряд на наличие единичного корня:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adf.test</span>(x)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Augmented Dickey-Fuller Test
## 
## data:  x
## Dickey-Fuller = -2.6459, Lag order = 9, p-value = 0.3049
## alternative hypothesis: stationary</code></pre>
</div>
</div>
<p>Продифференцируем ряд:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(<span class="fu">diff</span>(x), <span class="st">"partial"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-157-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Похоже на AR(1) процесс. Подберем лучшую модель:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>(auto_fit <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(x, <span class="at">stepwise =</span> <span class="cn">FALSE</span>, <span class="at">approximation =</span> <span class="cn">FALSE</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Series: x 
## ARIMA(1,1,0) with drift 
## 
## Coefficients:
##          ar1   drift
##       0.3620  0.1218
## s.e.  0.0296  0.0493
## 
## sigma^2 = 0.9919:  log likelihood = -1412.51
## AIC=2831.02   AICc=2831.04   BIC=2845.74</code></pre>
</div>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(auto_fit)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-158-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals from ARIMA(1,1,0) with drift
## Q* = 3.0964, df = 9, p-value = 0.9603
## 
## Model df: 1.   Total lags used: 10</code></pre>
</div>
</div>
<p>Сделаем прогноз:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">forecast</span>(auto_fit), <span class="at">include =</span> <span class="dv">200</span>, <span class="at">ylab =</span> <span class="st">""</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-159-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>ts1 <span class="ot">&lt;-</span> <span class="fu">as.ts</span>(<span class="fu">read.csv</span>(<span class="st">"./data/ts1.txt"</span>, <span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(ts1, <span class="at">plot.type =</span> <span class="st">"partial"</span>, <span class="at">lag.max =</span> <span class="dv">50</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-160-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>PACF обрывается после лага <span class="math inline">\(2\)</span>, а ACF экспоненциально затухает. Поэтому выберем модель ARIMA(2, 0, 0).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>(fit <span class="ot">&lt;-</span> <span class="fu">Arima</span>(ts1, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>)))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Series: ts1 
## ARIMA(2,0,0) with non-zero mean 
## 
## Coefficients:
##          ar1      ar2     mean
##       0.8565  -0.1585  99.9187
## s.e.  0.0312   0.0313   0.1083
## 
## sigma^2 = 1.076:  log likelihood = -1454.25
## AIC=2916.5   AICc=2916.54   BIC=2936.13</code></pre>
</div>
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(fit, <span class="at">lag.max =</span> <span class="dv">50</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-161-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals from ARIMA(2,0,0) with non-zero mean
## Q* = 10.412, df = 8, p-value = 0.2373
## 
## Model df: 2.   Total lags used: 10</code></pre>
</div>
</div>
<p>Теперь автоматически подберем модель:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>auto_fit <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(</span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>  ts1,</span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">max.p =</span> <span class="dv">3</span>, <span class="at">max.q =</span> <span class="dv">3</span>,</span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">stationary =</span> <span class="cn">TRUE</span>,</span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">stepwise =</span> <span class="cn">FALSE</span>,</span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">approximation =</span> <span class="cn">FALSE</span></span>
<span id="cb222-8"><a href="#cb222-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  ARIMA(0,0,0) with zero mean     : 12048.89
##  ARIMA(0,0,0) with non-zero mean : 3725.26
##  ARIMA(0,0,1) with zero mean     : Inf
##  ARIMA(0,0,1) with non-zero mean : 3137.908
##  ARIMA(0,0,2) with zero mean     : 9457.261
##  ARIMA(0,0,2) with non-zero mean : 2992.972
##  ARIMA(0,0,3) with zero mean     : 8347.406
##  ARIMA(0,0,3) with non-zero mean : 2935.968
##  ARIMA(1,0,0) with zero mean     : Inf
##  ARIMA(1,0,0) with non-zero mean : 2939.839
##  ARIMA(1,0,1) with zero mean     : Inf
##  ARIMA(1,0,1) with non-zero mean : 2916.03
##  ARIMA(1,0,2) with zero mean     : Inf
##  ARIMA(1,0,2) with non-zero mean : 2917.988
##  ARIMA(1,0,3) with zero mean     : Inf
##  ARIMA(1,0,3) with non-zero mean : 2919.812
##  ARIMA(2,0,0) with zero mean     : Inf
##  ARIMA(2,0,0) with non-zero mean : 2916.543
##  ARIMA(2,0,1) with zero mean     : Inf
##  ARIMA(2,0,1) with non-zero mean : 2917.977
##  ARIMA(2,0,2) with zero mean     : Inf
##  ARIMA(2,0,2) with non-zero mean : 2908.231
##  ARIMA(2,0,3) with zero mean     : Inf
##  ARIMA(2,0,3) with non-zero mean : 2908.491
##  ARIMA(3,0,0) with zero mean     : Inf
##  ARIMA(3,0,0) with non-zero mean : 2917.992
##  ARIMA(3,0,1) with zero mean     : Inf
##  ARIMA(3,0,1) with non-zero mean : 2907.243
##  ARIMA(3,0,2) with zero mean     : Inf
##  ARIMA(3,0,2) with non-zero mean : 2909.217
## 
## 
## 
##  Best model: ARIMA(3,0,1) with non-zero mean</code></pre>
</div>
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>auto_fit</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Series: ts1 
## ARIMA(3,0,1) with non-zero mean 
## 
## Coefficients:
##           ar1     ar2      ar3     ma1     mean
##       -0.0917  0.6303  -0.1186  0.9664  99.9183
## s.e.   0.0375  0.0337   0.0333  0.0197   0.1101
## 
## sigma^2 = 1.063:  log likelihood = -1447.58
## AIC=2907.16   AICc=2907.24   BIC=2936.61</code></pre>
</div>
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(auto_fit, <span class="at">lag.max =</span> <span class="dv">50</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-162-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals from ARIMA(3,0,1) with non-zero mean
## Q* = 6.1555, df = 6, p-value = 0.406
## 
## Model df: 4.   Total lags used: 10</code></pre>
</div>
</div>
<p>По IC модель ARIMA(2, 0, 0) заметно хуже ARIMA(3, 0, 1). На самом деле, истинная модель ARIMA(1, 0, 1), которая по IC близка к ARIMA(2, 0, 0).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>ts5 <span class="ot">&lt;-</span> <span class="fu">as.ts</span>(<span class="fu">read.csv</span>(<span class="st">"./data/ts5.txt"</span>, <span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(ts5, <span class="at">plot.type =</span> <span class="st">"partial"</span>, <span class="at">lag.max =</span> <span class="dv">50</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-163-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Похоже на модель ARIMA(3, 0, 2).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>(fit <span class="ot">&lt;-</span> <span class="fu">Arima</span>(ts5, <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">2</span>), <span class="at">include.mean =</span> <span class="cn">FALSE</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Series: ts5 
## ARIMA(3,0,2) with zero mean 
## 
## Coefficients:
##          ar1      ar2     ar3     ma1     ma2
##       0.1413  -0.2796  0.1223  0.1686  0.1740
## s.e.  0.3007   0.1123  0.0415  0.3018  0.1553
## 
## sigma^2 = 0.3963:  log likelihood = -1909.77
## AIC=3831.54   AICc=3831.58   BIC=3865.14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(fit, <span class="at">lag.max =</span> <span class="dv">50</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-164-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals from ARIMA(3,0,2) with zero mean
## Q* = 6.9261, df = 5, p-value = 0.2262
## 
## Model df: 5.   Total lags used: 10</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>auto_fit <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(</span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>  ts5,</span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">max.p =</span> <span class="dv">3</span>, <span class="at">max.q =</span> <span class="dv">2</span>,</span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">stationary =</span> <span class="cn">TRUE</span>,</span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">stepwise =</span> <span class="cn">FALSE</span>,</span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">trace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">approximation =</span> <span class="cn">FALSE</span></span>
<span id="cb233-8"><a href="#cb233-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  ARIMA(0,0,0) with zero mean     : 4020.233
##  ARIMA(0,0,0) with non-zero mean : 4022.044
##  ARIMA(0,0,1) with zero mean     : 3839.549
##  ARIMA(0,0,1) with non-zero mean : 3841.435
##  ARIMA(0,0,2) with zero mean     : 3833.206
##  ARIMA(0,0,2) with non-zero mean : 3835.076
##  ARIMA(1,0,0) with zero mean     : 3878.979
##  ARIMA(1,0,0) with non-zero mean : 3880.873
##  ARIMA(1,0,1) with zero mean     : 3833.555
##  ARIMA(1,0,1) with non-zero mean : 3835.429
##  ARIMA(1,0,2) with zero mean     : 3835.177
##  ARIMA(1,0,2) with non-zero mean : 3837.05
##  ARIMA(2,0,0) with zero mean     : 3846.239
##  ARIMA(2,0,0) with non-zero mean : 3848.097
##  ARIMA(2,0,1) with zero mean     : 3834.8
##  ARIMA(2,0,1) with non-zero mean : 3836.671
##  ARIMA(2,0,2) with zero mean     : 3834.094
##  ARIMA(2,0,2) with non-zero mean : 3835.972
##  ARIMA(3,0,0) with zero mean     : 3828.799
##  ARIMA(3,0,0) with non-zero mean : 3830.688
##  ARIMA(3,0,1) with zero mean     : 3830.809
##  ARIMA(3,0,1) with non-zero mean : 3832.701
##  ARIMA(3,0,2) with zero mean     : 3831.58
##  ARIMA(3,0,2) with non-zero mean : 3833.471
## 
## 
## 
##  Best model: ARIMA(3,0,0) with zero mean</code></pre>
</div>
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>auto_fit</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Series: ts5 
## ARIMA(3,0,0) with zero mean 
## 
## Coefficients:
##          ar1      ar2     ar3
##       0.3103  -0.1605  0.0984
## s.e.  0.0222   0.0230  0.0223
## 
## sigma^2 = 0.3961:  log likelihood = -1910.39
## AIC=3828.78   AICc=3828.8   BIC=3851.18</code></pre>
</div>
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(auto_fit, <span class="at">lag.max =</span> <span class="dv">50</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-165-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals from ARIMA(3,0,0) with zero mean
## Q* = 8.1128, df = 7, p-value = 0.3227
## 
## Model df: 3.   Total lags used: 10</code></pre>
</div>
</div>
<p>Наилучшей моделью оказалась ARIMA(3, 0, 0), которая и является истинной.</p>
</section>
<section id="реальные-данные-5" class="level2" data-number="19.2">
<h2 data-number="19.2" class="anchored" data-anchor-id="реальные-данные-5"><span class="header-section-number">19.2</span> Реальные данные</h2>
<p>Автоматически подберем модель ARIMA для остатков после выделения тренда и сезонности с помощью SSA.</p>
<section id="уровень-воды-реки-нил-2" class="level3" data-number="19.2.1">
<h3 data-number="19.2.1" class="anchored" data-anchor-id="уровень-воды-реки-нил-2"><span class="header-section-number">19.2.1</span> Уровень воды реки Нил</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>rNile <span class="ot">&lt;-</span> <span class="fu">resid</span>(r_NileMin)</span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(rNile, <span class="at">plot.type =</span> <span class="st">"partial"</span>, <span class="at">lag.max =</span> <span class="dv">50</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-166-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>rNile_train <span class="ot">&lt;-</span> <span class="fu">head</span>(rNile, <span class="sc">-</span><span class="dv">10</span>)</span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>rNile_test <span class="ot">&lt;-</span> <span class="fu">tail</span>(rNile, <span class="dv">10</span>)</span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>arima_Nile <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(</span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a>  rNile_train,</span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">stationary =</span> <span class="cn">TRUE</span>,</span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">stepwise =</span> <span class="cn">FALSE</span>,</span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">approximation =</span> <span class="cn">FALSE</span></span>
<span id="cb240-8"><a href="#cb240-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb240-9"><a href="#cb240-9" aria-hidden="true" tabindex="-1"></a>arima_Nile</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Series: rNile_train 
## ARIMA(1,0,2) with zero mean 
## 
## Coefficients:
##          ar1      ma1      ma2
##       0.7333  -0.3581  -0.0973
## s.e.  0.0968   0.1064   0.0601
## 
## sigma^2 = 4682:  log likelihood = -3684.56
## AIC=7377.11   AICc=7377.17   BIC=7395.04</code></pre>
</div>
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(arima_Nile, <span class="at">plot.type =</span> <span class="st">"hist"</span>, <span class="at">lag.max =</span> <span class="dv">50</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-167-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals from ARIMA(1,0,2) with zero mean
## Q* = 3.0599, df = 7, p-value = 0.8794
## 
## Model df: 3.   Total lags used: 10</code></pre>
</div>
</div>
<p>Нет основания отвергать гипотезу о белом шуме, поэтому сделаем прогноз. Поскольку остатки не похожи на нормальное распределение, предсказательные интервалы будем вычислять с помощью бутстрепа:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">forecast</span>(arima_Nile, <span class="at">bootstrap =</span> <span class="cn">TRUE</span>), <span class="at">include =</span> <span class="dv">200</span>, <span class="at">ylab =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(rNile_test, <span class="at">colour =</span> <span class="cn">FALSE</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-168-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="дебетовые-карты-4" class="level3" data-number="19.2.2">
<h3 data-number="19.2.2" class="anchored" data-anchor-id="дебетовые-карты-4"><span class="header-section-number">19.2.2</span> Дебетовые карты</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>rdebit <span class="ot">&lt;-</span> <span class="fu">resid</span>(reos_debit)</span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(rdebit, <span class="at">plot.type =</span> <span class="st">"partial"</span>, <span class="at">lag.max =</span> <span class="dv">50</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-169-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>arima_debit <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(</span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>  rdebit,</span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">stationary =</span> <span class="cn">TRUE</span>,</span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">seasonal =</span> <span class="cn">FALSE</span>,</span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">stepwise =</span> <span class="cn">FALSE</span>,</span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">approximation =</span> <span class="cn">FALSE</span></span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a>arima_debit</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Series: rdebit 
## ARIMA(0,0,3) with zero mean 
## 
## Coefficients:
##           ma1     ma2     ma3
##       -0.0411  0.0953  0.3832
## s.e.   0.0871  0.0705  0.1096
## 
## sigma^2 = 225793:  log likelihood = -999.65
## AIC=2007.3   AICc=2007.61   BIC=2018.83</code></pre>
</div>
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(arima_debit, <span class="at">lag.max =</span> <span class="dv">50</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-170-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals from ARIMA(0,0,3) with zero mean
## Q* = 56.817, df = 21, p-value = 3.824e-05
## 
## Model df: 3.   Total lags used: 24</code></pre>
</div>
</div>
<p>Нулевая гипотеза о белом шуме отверглась, видимо, в ряде осталась часть сезонности. Предсказывать неверную модель смысла нет.</p>
</section>
</section>
</section>
<section id="seasonal-arima" class="level1" data-number="20">
<h1 data-number="20"><span class="header-section-number">20</span> Seasonal ARIMA</h1>
<p>Подберем сезонную модель ARIMA для данных <code>debitcards</code> без двух периодов:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a>sarima_debit <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(</span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>  debit_trunc,</span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">stepwise =</span> <span class="cn">FALSE</span>,</span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lambda =</span> <span class="st">"auto"</span></span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a>sarima_debit</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Series: debit_trunc 
## ARIMA(2,1,0)(0,1,1)[12] 
## Box Cox transformation: lambda= 0.2915094 
## 
## Coefficients:
##           ar1      ar2     sma1
##       -0.7410  -0.4557  -0.7704
## s.e.   0.0825   0.0835   0.1116
## 
## sigma^2 = 0.676:  log likelihood = -149.77
## AIC=307.55   AICc=307.9   BIC=318.66</code></pre>
</div>
</div>
<p>Проверим остатки:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(sarima_debit, <span class="at">plot.type =</span> <span class="st">"hist"</span>, <span class="at">lag.max =</span> <span class="dv">50</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-172-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals from ARIMA(2,1,0)(0,1,1)[12]
## Q* = 26.381, df = 21, p-value = 0.1923
## 
## Model df: 3.   Total lags used: 24</code></pre>
</div>
</div>
<p>Теперь гипотеза не отвергается, но остатки не распределены нормально. Посмотрим на прогноз с бутстреп-интервалами:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>for_sarima <span class="ot">&lt;-</span> <span class="fu">forecast</span>(sarima_debit, <span class="dv">24</span>, <span class="at">bootstrap =</span> <span class="cn">TRUE</span>)</span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(for_sarima, <span class="at">flwd =</span> <span class="dv">1</span>, <span class="at">ylab =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(debitcards, <span class="at">color =</span> <span class="st">"black"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-173-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Сравним его с истинными значениями и с SSA прогнозом:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">tail</span>(debitcards, <span class="dv">36</span>), <span class="at">ylab =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(for_sarima<span class="sc">$</span>mean, <span class="at">series =</span> <span class="st">"SARIMA"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(rfor_debit, <span class="at">series =</span> <span class="st">"SSA"</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-174-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Ошибки предсказаний:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a>rmse_debit <span class="ot">&lt;-</span> rmse_debit <span class="sc">|&gt;</span></span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">Method =</span> <span class="st">"SARIMA"</span>, <span class="at">RMSE =</span> <span class="fu">rmse</span>(debitcards, for_sarima<span class="sc">$</span>mean))</span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a>rmse_debit <span class="sc">|&gt;</span> <span class="fu">arrange</span>(RMSE)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Method</th>
<th style="text-align: right;">RMSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SARIMA</td>
<td style="text-align: right;">779.4278</td>
</tr>
<tr class="even">
<td style="text-align: left;">SSA (recurrent)</td>
<td style="text-align: right;">1436.7990</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SSA (vector)</td>
<td style="text-align: right;">2363.8067</td>
</tr>
<tr class="even">
<td style="text-align: left;">SSA (recurrent with bootstrap)</td>
<td style="text-align: right;">2845.1905</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="обнаружение-разладки" class="level1" data-number="21">
<h1 data-number="21"><span class="header-section-number">21</span> Обнаружение разладки</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>hfunc <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">B =</span> N <span class="sc">%/%</span> <span class="dv">4</span>, <span class="at">T =</span> N <span class="sc">%/%</span> <span class="dv">4</span>, <span class="at">L =</span> B <span class="sc">%/%</span> <span class="dv">2</span>, <span class="at">neig =</span> <span class="dv">10</span>) {</span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> <span class="fu">hmatr</span>(x, <span class="at">B =</span> B, <span class="at">T =</span> T, <span class="at">L =</span> L, <span class="at">neig =</span> neig)</span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a>  hf_diag <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, T <span class="sc">+</span> B), h[<span class="fu">row</span>(h) <span class="sc">==</span> <span class="fu">col</span>(h) <span class="sc">+</span> B])</span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a>  hf_row <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, T), h[, <span class="dv">1</span>])</span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb257-6"><a href="#cb257-6" aria-hidden="true" tabindex="-1"></a>  hf <span class="ot">&lt;-</span></span>
<span id="cb257-7"><a href="#cb257-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">Time =</span> <span class="fu">time</span>(x), <span class="at">diagonal =</span> hf_diag, <span class="at">row =</span> hf_row) <span class="sc">|&gt;</span></span>
<span id="cb257-8"><a href="#cb257-8" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb257-9"><a href="#cb257-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb257-10"><a href="#cb257-10" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hf, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb257-11"><a href="#cb257-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">linetype =</span> name, <span class="at">lwd =</span> name), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb257-12"><a href="#cb257-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linewidth_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"diagonal"</span> <span class="ot">=</span> <span class="fl">0.5</span>, <span class="st">"row"</span> <span class="ot">=</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb257-13"><a href="#cb257-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"diagonal"</span> <span class="ot">=</span> <span class="st">"solid"</span>, <span class="st">"row"</span> <span class="ot">=</span> <span class="st">"dashed"</span>)) <span class="sc">+</span> </span>
<span id="cb257-14"><a href="#cb257-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"heterogeneity"</span>) <span class="sc">+</span></span>
<span id="cb257-15"><a href="#cb257-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb257-16"><a href="#cb257-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb257-17"><a href="#cb257-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb257-18"><a href="#cb257-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">hmatr =</span> h, <span class="at">plot =</span> p)</span>
<span id="cb257-19"><a href="#cb257-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="модельные-ряды-2" class="level2" data-number="21.1">
<h2 data-number="21.1" class="anchored" data-anchor-id="модельные-ряды-2"><span class="header-section-number">21.1</span> Модельные ряды</h2>
<p>Изменение частоты:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a>Q <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">numeric</span>(N))</span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">1</span><span class="sc">:</span>Q] <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fl">0.1</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span>Q))</span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a>x[(Q <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>N] <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fl">0.15</span> <span class="sc">*</span> ((Q <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>N))</span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-7"><a href="#cb258-7" aria-hidden="true" tabindex="-1"></a>hf <span class="ot">&lt;-</span> <span class="fu">hfunc</span>(x, <span class="at">neig =</span> <span class="dv">2</span>)</span>
<span id="cb258-8"><a href="#cb258-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="fu">autoplot</span>(x, <span class="at">ylab =</span> <span class="st">""</span>), hf<span class="sc">$</span>plot, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-177-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Сплошной линией нарисована диагональная функция разладки, а пунктирной — строковая. Матрица разладки:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">hcl.colors</span>(<span class="dv">256</span>, <span class="st">"Grays"</span>))</span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hf<span class="sc">$</span>hmatr, <span class="at">col =</span> pal)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-178-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Увеличение ранга сигнала:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">1</span><span class="sc">:</span>Q] <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fl">0.1</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span>Q))</span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>x[(Q <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>N] <span class="ot">&lt;-</span> </span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.8</span> <span class="sc">*</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fl">0.1</span> <span class="sc">*</span> ((Q <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>N)) <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fl">0.2</span> <span class="sc">*</span> ((Q <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>N))</span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>hf <span class="ot">&lt;-</span> <span class="fu">hfunc</span>(x, <span class="at">L =</span> <span class="dv">20</span>, <span class="at">neig =</span> <span class="dv">2</span>)</span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="fu">autoplot</span>(x, <span class="at">ylab =</span> <span class="st">""</span>), hf<span class="sc">$</span>plot, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-179-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hf<span class="sc">$</span>hmatr, <span class="at">col =</span> pal)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-180-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Уменьшение ранга сигнала:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">rev</span>(x))</span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>hf <span class="ot">&lt;-</span> <span class="fu">hfunc</span>(x, <span class="at">L =</span> <span class="dv">20</span>, <span class="at">neig =</span> <span class="dv">4</span>)</span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="fu">autoplot</span>(x, <span class="at">ylab =</span> <span class="st">""</span>), hf<span class="sc">$</span>plot, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-181-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hf<span class="sc">$</span>hmatr, <span class="at">col =</span> pal)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-182-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Функция модуля:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">1</span><span class="sc">:</span>N] <span class="ot">&lt;-</span> <span class="fu">abs</span>((<span class="dv">1</span><span class="sc">:</span>N) <span class="sc">-</span> Q)</span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>hf <span class="ot">&lt;-</span> <span class="fu">hfunc</span>(x, <span class="at">B =</span> <span class="dv">40</span>, <span class="at">T =</span> <span class="dv">40</span>, <span class="at">L =</span> <span class="dv">20</span>, <span class="at">neig =</span> <span class="dv">2</span>)</span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="fu">autoplot</span>(x, <span class="at">ylab =</span> <span class="st">""</span>), hf<span class="sc">$</span>plot, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-183-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hf<span class="sc">$</span>hmatr, <span class="at">col =</span> pal)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-184-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="реальные-ряды" class="level2" data-number="21.2">
<h2 data-number="21.2" class="anchored" data-anchor-id="реальные-ряды"><span class="header-section-number">21.2</span> Реальные ряды</h2>
<section id="дебетовые-карты-5" class="level3" data-number="21.2.1">
<h3 data-number="21.2.1" class="anchored" data-anchor-id="дебетовые-карты-5"><span class="header-section-number">21.2.1</span> Дебетовые карты</h3>
<p>Будем искать разладку в тренде, сперва удалим сезонность:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">ssa</span>(debitcards, <span class="dv">72</span>, <span class="at">svd.method =</span> <span class="st">"svd"</span>)</span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>eos <span class="ot">&lt;-</span> <span class="fu">eossa_new</span>(s, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>), <span class="st">"distance"</span>)</span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a>r_eos <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(eos, <span class="fu">list</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">14</span>))</span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a>(p1 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(<span class="fu">resid</span>(r_eos), <span class="at">ylab =</span> <span class="st">""</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-185-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ssa</span>(<span class="fu">resid</span>(r_eos)[<span class="dv">1</span><span class="sc">:</span><span class="dv">48</span>], <span class="at">L =</span> <span class="dv">24</span>), <span class="st">"vectors"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-186-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Будем брать первую компоненту разложения.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a>hf <span class="ot">&lt;-</span> <span class="fu">hfunc</span>(<span class="fu">resid</span>(r_eos), <span class="at">B =</span> <span class="dv">48</span>, <span class="at">T =</span> <span class="dv">48</span>, <span class="at">L =</span> <span class="dv">24</span>, <span class="at">neig =</span> <span class="dv">1</span>)</span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(p1, hf<span class="sc">$</span>plot, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-187-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Функции разладки заметила изменение структуры ряда с начала <span class="math inline">\(2005\)</span> года и с середины <span class="math inline">\(2008\)</span> года, что видно по ряду. Матрица разладки:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hf<span class="sc">$</span>hmatr, <span class="at">col =</span> pal)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-188-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="индекс-dow-jones" class="level3" data-number="21.2.2">
<h3 data-number="21.2.2" class="anchored" data-anchor-id="индекс-dow-jones"><span class="header-section-number">21.2.2</span> Индекс Dow-Jones</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"dj"</span>, <span class="at">package =</span> <span class="st">"fma"</span>)</span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a>(p1 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(dj, <span class="at">ylab =</span> <span class="st">""</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-189-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ssa</span>(dj[<span class="dv">1</span><span class="sc">:</span><span class="dv">40</span>], <span class="dv">20</span>), <span class="st">"vector"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-190-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Будем описывать тренд двумя компонентами.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>hf <span class="ot">&lt;-</span> <span class="fu">hfunc</span>(dj, <span class="at">B =</span> <span class="dv">40</span>, <span class="at">T =</span> <span class="dv">40</span>, <span class="at">L =</span> <span class="dv">20</span>, <span class="at">neig =</span> <span class="dv">2</span>)</span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(p1, hf<span class="sc">$</span>plot, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-191-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Ряд имеет по крайней мере одну разладку в среднем, функции разладки это изменение и обнаружили. Матрица разладки:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hf<span class="sc">$</span>hmatr, <span class="at">col =</span> pal)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-192-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="экспоненциальное-сглаживание" class="level1" data-number="22">
<h1 data-number="22"><span class="header-section-number">22</span> Экспоненциальное сглаживание</h1>
<section id="simple-exponential-smoothing" class="level2" data-number="22.1">
<h2 data-number="22.1" class="anchored" data-anchor-id="simple-exponential-smoothing"><span class="header-section-number">22.1</span> Simple exponential smoothing</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">ses</span>(debitcards)</span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">forecast</span>(fit), <span class="at">ylab =</span> <span class="st">""</span>) <span class="sc">+</span> <span class="fu">autolayer</span>(fit<span class="sc">$</span>fitted, <span class="at">color =</span><span class="st">"#D55E00"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-193-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="holts-method" class="level2" data-number="22.2">
<h2 data-number="22.2" class="anchored" data-anchor-id="holts-method"><span class="header-section-number">22.2</span> Holt’s method</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">holt</span>(debitcards)</span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit, <span class="at">ylab =</span> <span class="st">""</span>) <span class="sc">+</span> <span class="fu">autolayer</span>(fit<span class="sc">$</span>fitted, <span class="at">color =</span><span class="st">"#D55E00"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-194-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Можно сделать тренд затухающим:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a>fit_damped <span class="ot">&lt;-</span> <span class="fu">holt</span>(debitcards, <span class="at">damped =</span> <span class="cn">TRUE</span>)</span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">forecast</span>(fit_damped), <span class="at">ylab =</span> <span class="st">""</span>) <span class="sc">+</span> <span class="fu">autolayer</span>(fit_damped<span class="sc">$</span>fitted, <span class="at">color =</span><span class="st">"#D55E00"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-195-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="holt-winters-method" class="level2" data-number="22.3">
<h2 data-number="22.3" class="anchored" data-anchor-id="holt-winters-method"><span class="header-section-number">22.3</span> Holt-Winters’ method</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">hw</span>(debitcards, <span class="at">seasonal =</span> <span class="st">"multiplicative"</span>)</span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">forecast</span>(fit), <span class="at">ylab =</span> <span class="st">""</span>) <span class="sc">+</span> <span class="fu">autolayer</span>(fit<span class="sc">$</span>fitted, <span class="at">color =</span><span class="st">"#D55E00"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-196-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="выбор-модели" class="level2" data-number="22.4">
<h2 data-number="22.4" class="anchored" data-anchor-id="выбор-модели"><span class="header-section-number">22.4</span> Выбор модели</h2>
<p>Автоматически подберем модель для ряда без двух периодов:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>(ets_debit <span class="ot">&lt;-</span> <span class="fu">ets</span>(debit_trunc))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## ETS(M,A,M) 
## 
## Call:
## ets(y = debit_trunc)
## 
##   Smoothing parameters:
##     alpha = 0.2375 
##     beta  = 0.0122 
##     gamma = 1e-04 
## 
##   Initial states:
##     l = 8094.1229 
##     b = 98.3288 
##     s = 1.2677 0.9566 0.99 0.9719 1.0937 1.0566
##            1.0423 1.0182 0.9179 0.9269 0.8629 0.8952
## 
##   sigma:  0.049
## 
##      AIC     AICc      BIC 
## 2383.313 2388.682 2432.321</code></pre>
</div>
</div>
<p>Выбралась модель ETS(M, A, M), то есть модель с мультипликативными ошибками и сезонностью и с аддитивным трендом. Посмотрим на остатки:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(ets_debit, <span class="at">plot.type =</span> <span class="st">"hist"</span>, <span class="at">lag.max =</span> <span class="dv">50</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-198-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Ljung-Box test
## 
## data:  Residuals from ETS(M,A,M)
## Q* = 39.104, df = 24, p-value = 0.02663
## 
## Model df: 0.   Total lags used: 24</code></pre>
</div>
</div>
<p>При уровне значимости <span class="math inline">\(\alpha=0.01\)</span> нулевая гипотеза не отвергается, построим на предсказания:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>fc_ets <span class="ot">&lt;-</span> <span class="fu">forecast</span>(ets_debit, <span class="at">h =</span> <span class="dv">24</span>, <span class="at">bootstrap =</span> <span class="cn">TRUE</span>)</span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fc_ets, <span class="at">flwd =</span> <span class="dv">1</span>, <span class="at">ylab =</span> <span class="st">""</span>) <span class="sc">+</span> <span class="fu">autolayer</span>(debitcards, <span class="at">color =</span> <span class="st">"black"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-199-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Сравним полученные прогнозы с прогнозами других методов, рассмотренных ранее:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>ets_debit_damped <span class="ot">&lt;-</span> <span class="fu">ets</span>(debit_trunc, <span class="at">damped =</span> <span class="cn">TRUE</span>)</span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a>fc_ets_damped <span class="ot">&lt;-</span> <span class="fu">forecast</span>(ets_debit_damped, <span class="at">h =</span> <span class="dv">24</span>, <span class="at">PI =</span> <span class="cn">FALSE</span>)</span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">tail</span>(debitcards, <span class="dv">36</span>), <span class="at">ylab =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb283-5"><a href="#cb283-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(fc_ets<span class="sc">$</span>mean, <span class="at">series =</span> <span class="st">"ETS"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb283-6"><a href="#cb283-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(fc_ets_damped<span class="sc">$</span>mean, <span class="at">series =</span> <span class="st">"ETS (damped)"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb283-7"><a href="#cb283-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(for_sarima<span class="sc">$</span>mean, <span class="at">series =</span> <span class="st">"SARIMA"</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb283-8"><a href="#cb283-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(rfor_debit, <span class="at">series =</span> <span class="st">"SSA"</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-200-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Ошибки предсказаний:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>rmse_debit <span class="ot">&lt;-</span> <span class="fu">add_row</span>(</span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a>  rmse_debit,</span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Method =</span> <span class="fu">c</span>(<span class="st">"ETS"</span>, <span class="st">"ETS (damped)"</span>),</span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE =</span> <span class="fu">c</span>(<span class="fu">rmse</span>(debitcards, fc_ets<span class="sc">$</span>mean), <span class="fu">rmse</span>(debitcards, fc_ets_damped<span class="sc">$</span>mean))</span>
<span id="cb284-5"><a href="#cb284-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb284-6"><a href="#cb284-6" aria-hidden="true" tabindex="-1"></a>rmse_debit <span class="sc">|&gt;</span> <span class="fu">arrange</span>(RMSE)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Method</th>
<th style="text-align: right;">RMSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SARIMA</td>
<td style="text-align: right;">779.4278</td>
</tr>
<tr class="even">
<td style="text-align: left;">ETS</td>
<td style="text-align: right;">1060.6393</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ETS (damped)</td>
<td style="text-align: right;">1134.1526</td>
</tr>
<tr class="even">
<td style="text-align: left;">SSA (recurrent)</td>
<td style="text-align: right;">1436.7990</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SSA (vector)</td>
<td style="text-align: right;">2363.8067</td>
</tr>
<tr class="even">
<td style="text-align: left;">SSA (recurrent with bootstrap)</td>
<td style="text-align: right;">2845.1905</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>ETS оказалась по точности между SARIMA и SSA, причем модель с затухающим трендом оказалась хуже, но разница небольшая.</p>
</section>
</section>
<section id="mssa" class="level1" data-number="23">
<h1 data-number="23"><span class="header-section-number">23</span> MSSA</h1>
<section id="сравнение-с-ssa" class="level2" data-number="23.1">
<h2 data-number="23.1" class="anchored" data-anchor-id="сравнение-с-ssa"><span class="header-section-number">23.1</span> Сравнение с SSA</h2>
<p>Будем рассматривать только модельные ряды. Проверим, что если каналы имеют одинаковую структуру, то MSSA точнее выделяется сигнал, чем SSA. Шум будем рассматривать для простоты белый.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb285"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a>mssa_errors <span class="ot">&lt;-</span> <span class="cf">function</span>(signal,</span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a>                        L,</span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a>                        groups_mssa,</span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">groups_ssa =</span> groups_mssa,</span>
<span id="cb285-5"><a href="#cb285-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">M =</span> <span class="dv">500</span>,</span>
<span id="cb285-6"><a href="#cb285-6" aria-hidden="true" tabindex="-1"></a>                        ...) {</span>
<span id="cb285-7"><a href="#cb285-7" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(signal)</span>
<span id="cb285-8"><a href="#cb285-8" aria-hidden="true" tabindex="-1"></a>  mse <span class="ot">&lt;-</span> <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span>M) <span class="sc">%dorng%</span> {</span>
<span id="cb285-9"><a href="#cb285-9" aria-hidden="true" tabindex="-1"></a>    f <span class="ot">&lt;-</span> signal <span class="sc">+</span> <span class="fu">cbind</span>(<span class="fu">rnorm</span>(N, ...), <span class="fu">rnorm</span>(N, ...))</span>
<span id="cb285-10"><a href="#cb285-10" aria-hidden="true" tabindex="-1"></a>    f1 <span class="ot">&lt;-</span> f[, <span class="dv">1</span>]</span>
<span id="cb285-11"><a href="#cb285-11" aria-hidden="true" tabindex="-1"></a>    f2 <span class="ot">&lt;-</span> f[, <span class="dv">2</span>]</span>
<span id="cb285-12"><a href="#cb285-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb285-13"><a href="#cb285-13" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> <span class="fu">ssa</span>(f, L, <span class="at">kind =</span> <span class="st">"mssa"</span>, <span class="at">svd.method =</span> <span class="st">"svd"</span>)</span>
<span id="cb285-14"><a href="#cb285-14" aria-hidden="true" tabindex="-1"></a>    s1 <span class="ot">&lt;-</span> <span class="fu">ssa</span>(f1, L, <span class="at">kind =</span> <span class="st">"1d-ssa"</span>, <span class="at">svd.method =</span> <span class="st">"svd"</span>)</span>
<span id="cb285-15"><a href="#cb285-15" aria-hidden="true" tabindex="-1"></a>    s2 <span class="ot">&lt;-</span> <span class="fu">ssa</span>(f2, L, <span class="at">kind =</span> <span class="st">"1d-ssa"</span>, <span class="at">svd.method =</span> <span class="st">"svd"</span>)</span>
<span id="cb285-16"><a href="#cb285-16" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb285-17"><a href="#cb285-17" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(s, groups_mssa)[[<span class="dv">1</span>]]</span>
<span id="cb285-18"><a href="#cb285-18" aria-hidden="true" tabindex="-1"></a>    r1 <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(s1, groups_ssa)[[<span class="dv">1</span>]]</span>
<span id="cb285-19"><a href="#cb285-19" aria-hidden="true" tabindex="-1"></a>    r2 <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(s2, groups_ssa)[[<span class="dv">1</span>]]</span>
<span id="cb285-20"><a href="#cb285-20" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb285-21"><a href="#cb285-21" aria-hidden="true" tabindex="-1"></a>    mse1 <span class="ot">&lt;-</span> <span class="fu">mean</span>((r1 <span class="sc">-</span> signal[, <span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb285-22"><a href="#cb285-22" aria-hidden="true" tabindex="-1"></a>    mse2 <span class="ot">&lt;-</span> <span class="fu">mean</span>((r2 <span class="sc">-</span> signal[, <span class="dv">2</span>])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb285-23"><a href="#cb285-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb285-24"><a href="#cb285-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="fu">mean</span>((r <span class="sc">-</span> signal)<span class="sc">^</span><span class="dv">2</span>), (mse1 <span class="sc">+</span> mse2) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb285-25"><a href="#cb285-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb285-26"><a href="#cb285-26" aria-hidden="true" tabindex="-1"></a>  mse <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, mse) <span class="sc">|&gt;</span> <span class="fu">data.frame</span>(<span class="at">L =</span> <span class="fu">rep</span>(L, M))</span>
<span id="cb285-27"><a href="#cb285-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(mse) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"mssa"</span>, <span class="st">"ssa"</span>, <span class="st">"L"</span>)</span>
<span id="cb285-28"><a href="#cb285-28" aria-hidden="true" tabindex="-1"></a>  mse</span>
<span id="cb285-29"><a href="#cb285-29" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Будем рассмотривать ряды длинны <span class="math inline">\(N=100\)</span> и <span class="math inline">\(L\in\{10, 20, 50, 80, 90\}\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a>Ls <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">50</span>, <span class="dv">80</span>, <span class="dv">90</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="одинаковая-структура" class="level2" data-number="23.2">
<h2 data-number="23.2" class="anchored" data-anchor-id="одинаковая-структура"><span class="header-section-number">23.2</span> Одинаковая структура</h2>
<p>Возьмем косинусы с одинаковой частотой.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>signal_channel <span class="ot">&lt;-</span> <span class="fu">em_harmonic</span>(N, <span class="dv">1</span> <span class="sc">/</span> <span class="dv">12</span>)</span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a>signal1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">2</span> <span class="sc">*</span> signal_channel, <span class="fl">1.5</span> <span class="sc">*</span> signal_channel, <span class="at">deparse.level =</span> <span class="dv">0</span>)</span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">ts</span>(signal1), <span class="at">facets =</span> <span class="cn">TRUE</span>, <span class="at">ylab =</span> <span class="st">""</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-204-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> signal1 <span class="sc">+</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ssa</span>(x, <span class="at">kind =</span> <span class="st">"mssa"</span>), <span class="st">"vectors"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-205-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Ранг равен <span class="math inline">\(2\)</span>, как и ранг каждого канала.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a>mse1 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(Ls, <span class="cf">function</span>(L) <span class="fu">mssa_errors</span>(signal1, L, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))) <span class="sc">|&gt;</span></span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span></span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">L =</span> <span class="fu">factor</span>(L, <span class="at">levels =</span> Ls))</span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-7"><a href="#cb289-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mse1, <span class="fu">aes</span>(L, value, <span class="at">fill =</span> name)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"MSE"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-206-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="разная-структура" class="level2" data-number="23.3">
<h2 data-number="23.3" class="anchored" data-anchor-id="разная-структура"><span class="header-section-number">23.3</span> Разная структура</h2>
<p>В качестве сигнала рассмотрим экспоненты с разными показателями.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a>signal2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">em_harmonic</span>(N, <span class="dv">0</span>, <span class="at">a =</span> <span class="fl">0.05</span>), <span class="fu">em_harmonic</span>(N, <span class="dv">0</span>, <span class="at">a =</span> <span class="fl">0.025</span>))</span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">ts</span>(signal2), <span class="at">facets =</span> <span class="cn">TRUE</span>, <span class="at">ylab =</span> <span class="st">""</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-207-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> signal2 <span class="sc">+</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ssa</span>(x, <span class="at">kind =</span> <span class="st">"mssa"</span>), <span class="st">"vectors"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-208-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>В случае разной структуры ранг равен сумме рангов каналов.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>mse2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(Ls, <span class="cf">function</span>(L) <span class="fu">mssa_errors</span>(signal2, L, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="fu">list</span>(<span class="dv">1</span>))) <span class="sc">|&gt;</span></span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span></span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">L =</span> <span class="fu">factor</span>(L, <span class="at">levels =</span> Ls))</span>
<span id="cb292-6"><a href="#cb292-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-7"><a href="#cb292-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mse2, <span class="fu">aes</span>(L, value, <span class="at">fill =</span> name)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"MSE"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-209-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="поддерживающий-ряд" class="level2" data-number="23.4">
<h2 data-number="23.4" class="anchored" data-anchor-id="поддерживающий-ряд"><span class="header-section-number">23.4</span> Поддерживающий ряд</h2>
<p>Пусть у нас есть два ряда. Второй ряд называют поддерживающим, если при его учитывании ошибки восстановления сигнала первого ряда становятся меньше. Посмотрим, как от уровня шума во втором ряде зависит, является ли он поддерживающим. Поскольку в предыдущем разделе мы убедились, что MSSA точнее, когда каналы имеют одинаковую структуру, будем рассматривать имеенно этот случай.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a>support_errors <span class="ot">&lt;-</span> <span class="cf">function</span>(signal, L, groups, sds, <span class="at">M =</span> <span class="dv">500</span>) {</span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(signal)</span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a>  mse <span class="ot">&lt;-</span> <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span>M) <span class="sc">%dorng%</span> {</span>
<span id="cb293-4"><a href="#cb293-4" aria-hidden="true" tabindex="-1"></a>    noise1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb293-5"><a href="#cb293-5" aria-hidden="true" tabindex="-1"></a>    noise2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb293-6"><a href="#cb293-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb293-7"><a href="#cb293-7" aria-hidden="true" tabindex="-1"></a>    f <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sds, <span class="cf">function</span>(sd) signal <span class="sc">+</span> <span class="fu">cbind</span>(noise1, sd <span class="sc">*</span> noise2)) </span>
<span id="cb293-8"><a href="#cb293-8" aria-hidden="true" tabindex="-1"></a>    f1 <span class="ot">&lt;-</span> f[[<span class="dv">1</span>]][, <span class="dv">1</span>]</span>
<span id="cb293-9"><a href="#cb293-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb293-10"><a href="#cb293-10" aria-hidden="true" tabindex="-1"></a>    sl <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb293-11"><a href="#cb293-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">seq_along</span>(sds),</span>
<span id="cb293-12"><a href="#cb293-12" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(i) <span class="fu">ssa</span>(f[[i]], L, <span class="at">kind =</span> <span class="st">"mssa"</span>, <span class="at">svd.method =</span> <span class="st">"svd"</span>)</span>
<span id="cb293-13"><a href="#cb293-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb293-14"><a href="#cb293-14" aria-hidden="true" tabindex="-1"></a>    s1 <span class="ot">&lt;-</span> <span class="fu">ssa</span>(f1, L, <span class="at">kind =</span> <span class="st">"1d-ssa"</span>, <span class="at">svd.method =</span> <span class="st">"svd"</span>)</span>
<span id="cb293-15"><a href="#cb293-15" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb293-16"><a href="#cb293-16" aria-hidden="true" tabindex="-1"></a>    rl <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb293-17"><a href="#cb293-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">seq_along</span>(sds),</span>
<span id="cb293-18"><a href="#cb293-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(i) <span class="fu">reconstruct</span>(sl[[i]], groups)[[<span class="dv">1</span>]][, <span class="dv">1</span>]</span>
<span id="cb293-19"><a href="#cb293-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb293-20"><a href="#cb293-20" aria-hidden="true" tabindex="-1"></a>    r1 <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(s1, groups)[[<span class="dv">1</span>]]</span>
<span id="cb293-21"><a href="#cb293-21" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb293-22"><a href="#cb293-22" aria-hidden="true" tabindex="-1"></a>    mse_mssa <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb293-23"><a href="#cb293-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">seq_along</span>(sds),</span>
<span id="cb293-24"><a href="#cb293-24" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(i) <span class="fu">mean</span>((rl[[i]] <span class="sc">-</span> signal[, <span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb293-25"><a href="#cb293-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb293-26"><a href="#cb293-26" aria-hidden="true" tabindex="-1"></a>    mse_ssa <span class="ot">&lt;-</span> <span class="fu">mean</span>((r1 <span class="sc">-</span> signal[, <span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb293-27"><a href="#cb293-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb293-28"><a href="#cb293-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(mse_mssa, mse_ssa) </span>
<span id="cb293-29"><a href="#cb293-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb293-30"><a href="#cb293-30" aria-hidden="true" tabindex="-1"></a>  mse <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, mse) <span class="sc">|&gt;</span> <span class="fu">data.frame</span>()</span>
<span id="cb293-31"><a href="#cb293-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(mse) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"sigma="</span>, sds), <span class="st">"ssa"</span>)</span>
<span id="cb293-32"><a href="#cb293-32" aria-hidden="true" tabindex="-1"></a>  mse</span>
<span id="cb293-33"><a href="#cb293-33" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Зафиксируем <span class="math inline">\(L=50\)</span>. Рассмотрим стандартное отклонение шума <span class="math inline">\(\sigma=1\)</span> в первом ряде и <span class="math inline">\(\sigma\in[1, 5]\)</span> во втором.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a>sds <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="fl">0.1</span>)</span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-4"><a href="#cb294-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb294-5"><a href="#cb294-5" aria-hidden="true" tabindex="-1"></a>mse_support <span class="ot">&lt;-</span> <span class="fu">support_errors</span>(signal1, L, <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), sds)</span>
<span id="cb294-6"><a href="#cb294-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-7"><a href="#cb294-7" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">sigma =</span> sds, <span class="at">MSE =</span> <span class="fu">colMeans</span>(mse_support <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>ssa))) <span class="sc">|&gt;</span></span>
<span id="cb294-8"><a href="#cb294-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(sigma, MSE)) <span class="sc">+</span></span>
<span id="cb294-9"><a href="#cb294-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb294-10"><a href="#cb294-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(mse_support<span class="sc">$</span>ssa), <span class="at">lty =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb294-11"><a href="#cb294-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-211-1.svg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Пунктиром обозначена ошибка восстановления сигнала методом SSA. Как видим, начиная с <span class="math inline">\(\sigma=2.2\)</span>, второй ряд перестает быть поддерживающим.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Скопировано");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Скопировано");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>